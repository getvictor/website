<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="mTLS Hello World"><title>Mutual TLS intro and hands-on example</title><link rel=canonical href=https://victoronsoftware.com/posts/mtls-hello-world/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="Mutual TLS intro and hands-on example"><meta property='og:description' content="mTLS Hello World"><meta property='og:url' content='https://victoronsoftware.com/posts/mtls-hello-world/'><meta property='og:site_name' content='Victor on Software'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:tag' content='mTLS'><meta property='article:tag' content='TLS'><meta property='article:tag' content='Cyber Security'><meta property='article:tag' content='Hello World'><meta property='article:published_time' content='2024-01-24T00:00:00+00:00'><meta property='article:modified_time' content='2024-01-24T00:00:00+00:00'><meta property='og:image' content='https://victoronsoftware.com/posts/mtls-hello-world/mtls-handshake.png'><meta name=twitter:title content="Mutual TLS intro and hands-on example"><meta name=twitter:description content="mTLS Hello World"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://victoronsoftware.com/posts/mtls-hello-world/mtls-handshake.png'><script async src="https://www.googletagmanager.com/gtag/js?id=G-1XV381YSQ8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-1XV381YSQ8")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_c8fdb37897842f49.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Victor on Software</a></h1><h2 class=site-description>Software engineering, security, and related topics</h2></div></header><ol class=menu-social><li><a href=https://fleetdm.com target=_blank title=Fleet rel=me><svg width="58.219mm" height="58.202mm" viewBox="0 0 58.219 58.202"><g stroke-width=".26458"><path d="m7.5963 14.823c3.954.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2054-7.1594-7.1594-7.1594-3.954.0-7.1594 3.2053-7.1594 7.1594.0 3.954 3.2053 7.1594 7.1594 7.1594z" fill="#63c740"/><path d="m29.075 14.823c3.9539.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2054-7.1594-7.1594-7.1594-3.9541.0-7.1595 3.2053-7.1595 7.1594.0 3.954 3.2054 7.1594 7.1595 7.1594z" fill="#5cabdf"/><path d="m50.552 14.823c3.9542.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2052-7.1594-7.1594-7.1594-3.9539.0-7.1594 3.2053-7.1594 7.1594.0 3.954 3.2054 7.1594 7.1594 7.1594z" fill="#d66c7b"/><path d="m7.5963 36.301c3.954.0 7.1594-3.2054 7.1594-7.1594.0-3.9541-3.2054-7.1595-7.1594-7.1595-3.954.0-7.1594 3.2054-7.1594 7.1595.0 3.9539 3.2053 7.1594 7.1594 7.1594z" fill="#c98def"/><path d="m29.075 36.301c3.9539.0 7.1594-3.2054 7.1594-7.1594.0-3.9541-3.2054-7.1595-7.1594-7.1595-3.9541.0-7.1595 3.2054-7.1595 7.1595.0 3.9539 3.2054 7.1594 7.1595 7.1594z" fill="#faa669"/><path d="m7.5963 57.779c3.954.0 7.1594-3.2052 7.1594-7.1594.0-3.9539-3.2054-7.1594-7.1594-7.1594-3.954.0-7.1594 3.2054-7.1594 7.1594.0 3.9542 3.2053 7.1594 7.1594 7.1594z" fill="#3aefc4"/></g></svg></a></li><li><a href=https://github.com/getvictor target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/lyuboslavsky/ target=_blank title=LinkedIn rel=me><svg width="16" height="16" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16"><path d="M0 1.146C0 .513.526.0 1.175.0h13.65C15.474.0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487.0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401m-1.2-8.212c.837.0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822.0-1.359.54-1.359 1.248.0.694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869.0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274.0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54.0 01.016-.025V6.169h-2.4c.03.678.0 7.225.0 7.225h2.4"/></svg></a></li><li><a href=http://www.youtube.com/@VictorOnSoftware target=_blank title=YouTube rel=me><svg height="800" width="800" id="Layer_1" viewBox="0 0 461.001 461.001"><g><path style="fill:#f61c0d" d="M365.257 67.393H95.744C42.866 67.393.0 110.259.0 163.137v134.728c0 52.878 42.866 95.744 95.744 95.744h269.513c52.878.0 95.744-42.866 95.744-95.744V163.137c0-52.878-42.866-95.744-95.744-95.744zM300.506 237.056l-126.06 60.123c-3.359 1.602-7.239-.847-7.239-4.568V168.607c0-3.774 3.982-6.22 7.348-4.514l126.06 63.881C304.363 229.873 304.298 235.248 300.506 237.056z"/></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/page/speaking/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 2m0 3a3 3 0 013-3h0a3 3 0 013 3v5a3 3 0 01-3 3h0a3 3 0 01-3-3z"/><path d="M5 10a7 7 0 0014 0"/><path d="M8 21h8"/><path d="M12 17v4"/></svg>
<span>Speaking</span></a></li><li><a href=/page/tools/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Software tools</span></a></li><li><a href=/page/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/page/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/mtls-hello-world/><img src=/posts/mtls-hello-world/mtls-handshake_hu_d81e29e70591d46f.png srcset="/posts/mtls-hello-world/mtls-handshake_hu_d81e29e70591d46f.png 800w, /posts/mtls-hello-world/mtls-handshake_hu_5577ec9311890eb8.png 1600w" width=800 height=450 loading=lazy alt="Featured image of post Mutual TLS intro and hands-on example"></a></div><div class=article-details><header class=article-category><a href=/categories/security/>Security</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/posts/mtls-hello-world/>Mutual TLS intro and hands-on example</a></h2><h3 class=article-subtitle>mTLS Hello World</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jan 24, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>6 minute read</time></div></footer></div></header><section class=article-content><h2 id=what-is-mtls-mutual-tls><a href=#what-is-mtls-mutual-tls class=header-anchor></a>What is mTLS (mutual TLS)?</h2><p>TLS stands for Transport Layer Security. It is a cryptographic protocol that provides privacy and data integrity between
two communicating applications. It is the successor to SSL (Secure Sockets Layer).</p><p>In ordinary (non-mutual) TLS, the client authenticates the server, but the server does not authenticate the client. Most
websites use regular TLS. The client (web browser) knows it is talking to the correct server (website), but the server
knows very little about the client. Instead, web applications use other client authentication methods, such as
passwords, cookies, and session tokens.</p><p>Mutual TLS (mTLS) is a way to authenticate both the client and the server in a TLS connection. It is also known as
client certificate authentication. In addition to the server authenticating itself to the client, the client also
authenticates itself to the server.</p><p>mTLS is helpful as an additional layer of security. It is used in many applications, including:</p><ul><li>VPNs</li><li>Microservices</li><li>Service mesh</li><li>IoT (Internet of Things)</li><li>Mobile apps</li></ul><h2 id=how-does-fleet-device-management-use-mtls><a href=#how-does-fleet-device-management-use-mtls class=header-anchor></a>How does <a class=link href=https://fleetdm.com target=_blank rel=noopener>Fleet Device Management</a> use mTLS?</h2><p>Many of Fleet&rsquo;s customers use mTLS as an additional layer of security to authenticate the Fleet server to the Fleet
agent. The Fleet agent is a small program that runs on each host device, such as a corporate laptop. It collects
information about the host and sends it to the Fleet server.</p><h2 id=how-does-mtls-work><a href=#how-does-mtls-work class=header-anchor></a>How does mTLS work?</h2><p>TLS is a complex protocol with multiple versions (1.2, 1.3, etc.). We will only go over the basics to understand how
mTLS works.</p><p>TLS uses a handshake protocol to establish a secure connection. The handshake protocol is a series of messages between
the client and the server.</p><figure><img src=/posts/mtls-hello-world/mtls-handshake.png alt="Mutual TLS (mTLS) handshake diagram"></figure><p>The client sends a &ldquo;Client Hello&rdquo; message to the server. The server responds with a &ldquo;Server Hello&rdquo; message and sends its
certificate to the client. As an additional step for mTLS, the server requests a certificate from the client.</p><p>The client verifies the server&rsquo;s certificate by checking the certificate&rsquo;s signature and verifying that the certificate
is valid and has not expired. The client also checks that the server&rsquo;s hostname matches the hostname in the certificate.</p><p>The client uses the server&rsquo;s public key to encrypt the messages sent to the server, including the session key and its
certificate. The server decrypts these messages with its private key.</p><p>The client also sends a digital signature, encrypted with its private key, to the server. The server verifies the
signature by decrypting it with the client&rsquo;s public key.</p><p>At this point, both the client and the server have verified each other&rsquo;s identity. They complete the TLS handshake and
can exchange encrypted messages using a symmetric session key.</p><h2 id=generate-certificates-and-keys><a href=#generate-certificates-and-keys class=header-anchor></a>Generate certificates and keys</h2><p>We will use the <a class=link href=https://www.openssl.org/ target=_blank rel=noopener>OpenSSL</a> command line tool to generate the certificates. OpenSSL is a popular
open-source library for TLS and SSL protocols.</p><p>The following script generates the certificates and keys for the client and the server. It also creates two certificate
authorities (CAs) and signs the client and server certificates with their respective CA. The same CA may sign the
certificates, but we will use separate CAs for this example.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e># This script generates files needed for mTLS.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mkdir -p certs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Private keys for CAs</span>
</span></span><span style=display:flex><span>openssl genrsa -out certs/server-ca.key <span style=color:#ae81ff>2048</span>
</span></span><span style=display:flex><span>openssl genrsa -out certs/client-ca.key <span style=color:#ae81ff>2048</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Generate CA certificates</span>
</span></span><span style=display:flex><span>openssl req -new -x509 -nodes -days <span style=color:#ae81ff>1000</span> -key certs/server-ca.key -out certs/server-ca.crt
</span></span><span style=display:flex><span>openssl req -new -x509 -nodes -days <span style=color:#ae81ff>1000</span> -key certs/client-ca.key -out certs/client-ca.crt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Generate a certificate signing request</span>
</span></span><span style=display:flex><span>openssl req -newkey rsa:2048 -nodes -keyout certs/server.key -out certs/server.req
</span></span><span style=display:flex><span>openssl req -newkey rsa:2048 -nodes -keyout certs/client.key -out certs/client.req
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Have the CA sign the certificate requests and output the certificates.</span>
</span></span><span style=display:flex><span>openssl x509 -req -in certs/server.req -days <span style=color:#ae81ff>1000</span> -CA certs/server-ca.crt -CAkey certs/server-ca.key -set_serial <span style=color:#ae81ff>01</span> -out certs/server.crt -extfile localhost.ext
</span></span><span style=display:flex><span>openssl x509 -req -in certs/client.req -days <span style=color:#ae81ff>1000</span> -CA certs/client-ca.crt -CAkey certs/client-ca.key -set_serial <span style=color:#ae81ff>01</span> -out certs/client.crt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Clean up</span>
</span></span><span style=display:flex><span>rm certs/server.req
</span></span><span style=display:flex><span>rm certs/client.req
</span></span></code></pre></div><p>The <code>localhost.ext</code> file is used to specify the hostname for the server certificate. In our example, we will use
<code>localhost</code>. The file contains the following:</p><pre tabindex=0><code>authorityKeyIdentifier=keyid,issuer
basicConstraints=CA:FALSE
keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment
subjectAltName = @alt_names

[alt_names]
DNS.1 = localhost
</code></pre><h2 id=run-the-mtls-server><a href=#run-the-mtls-server class=header-anchor></a>Run the mTLS server</h2><p>We will use <a class=link href=https://www.nginx.com/ target=_blank rel=noopener>nginx</a> as our mTLS server. nginx is a popular open-source web server.</p><p>Using <code>docker compose</code>, we can run two nginx servers. One server will use ordinary TLS, and one will use mutual TLS. We
will use the following <code>docker-compose.yml</code> file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;2&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nginx-tls</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./certs/server.crt:/etc/nginx/certificates/server.crt</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./certs/server.key:/etc/nginx/certificates/server.key</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./nginx-tls/nginx.conf:/etc/nginx/conf.d/default.conf</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./nginx-tls/hello-world.txt:/www/data/hello-world.txt</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;8888:8888&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>nginx-mtls</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./certs/server.crt:/etc/nginx/certificates/server.crt</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./certs/server.key:/etc/nginx/certificates/server.key</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./certs/client-ca.crt:/etc/nginx/certificates/client-ca.crt</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./nginx-mtls/nginx.conf:/etc/nginx/conf.d/default.conf</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./nginx-mtls/hello-world.txt:/www/data/hello-world.txt</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;8889:8889&#34;</span>
</span></span></code></pre></div><p>The <code>nginx-tls</code> service uses the <code>nginx-tls/nginx.conf</code> file, which contains the following:</p><pre tabindex=0><code>server {
    listen 8888 ssl;
    server_name tls-hello-world;

    # Server TLS certificate (client must have the CA cert to connect)
    ssl_certificate /etc/nginx/certificates/server.crt;
    ssl_certificate_key /etc/nginx/certificates/server.key;

    location / {
        root /www/data;
    }
}
</code></pre><p>The <code>nginx-mtls</code> service uses the <code>nginx-mtls/nginx.conf</code> file, which contains the following:</p><pre tabindex=0><code>server {
    listen 8889 ssl;
    server_name mtls-hello-world;

    # Server TLS certificate (client must have the CA cert to connect)
    ssl_certificate /etc/nginx/certificates/server.crt;
    ssl_certificate_key /etc/nginx/certificates/server.key;

    # Enable mTLS
    ssl_client_certificate /etc/nginx/certificates/client-ca.crt;
    ssl_verify_client on;

    location / {
        root /www/data;
    }
}
</code></pre><p>The <code>hello-world.txt</code> files contain a simple text message.</p><h2 id=connect-to-the-mtls-server-with-curl-client><a href=#connect-to-the-mtls-server-with-curl-client class=header-anchor></a>Connect to the mTLS server with curl client</h2><p>We can connect to the mTLS server with the <code>curl</code> command line tool. We will use the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl https://localhost:8889/hello-world.txt --cacert ./certs/server-ca.crt --cert ./certs/client.crt --key ./certs/client.key
</span></span></code></pre></div><p>The <code>--cacert</code> option specifies the CA certificate that signed the server certificate. The <code>--cert</code> and <code>--key</code> options
select the client certificate and key.</p><p>To connect to the ordinary TLS server, we do not need to specify the client certificate and key:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl https://localhost:8888/hello-world.txt --cacert ./certs/server-ca.crt
</span></span></code></pre></div><p>Curl can use <code>--insecure</code> to ignore the server certificate:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl --insecure https://localhost:8888/hello-world.txt
</span></span></code></pre></div><p>However, it is impossible to ignore the client certificate for mTLS. The server will reject the connection if the client
does not provide a valid certificate.</p><h2 id=example-code-on-github><a href=#example-code-on-github class=header-anchor></a>Example code on GitHub</h2><p>The example code is available on GitHub at <a class=link href=https://github.com/getvictor/mtls/tree/master/hello-world target=_blank rel=noopener>https://github.com/getvictor/mtls/tree/master/hello-world</a></p><h2 id=securing-mtls-certificates-and-keys><a href=#securing-mtls-certificates-and-keys class=header-anchor></a>Securing mTLS certificates and keys</h2><p>In the next article, we will
<a class=link href=../mtls-with-apple-keychain>secure the mTLS certificates and keys with the macOS keychain</a>.</p><p>In a later article, we also
<a class=link href=../mtls-with-windows>secure the mTLS certificates and keys with the Windows certificate store</a>.</p><p>This article is part of a series on <a class=link href=../mtls>mTLS</a>.</p><h2 id=further-reading><a href=#further-reading class=header-anchor></a>Further reading</h2><ul><li><strong><a class=link href=../how-to-use-tpm/>How to Use TPM 2.0 to Secure Private Keys</a></strong> <em>Learn how to create, manage, and use TPM-backed
keys, including parent/child key hierarchies and secure signing.</em></li></ul><h2 id=mtls-hello-world-video><a href=#mtls-hello-world-video class=header-anchor></a>mTLS Hello World video</h2><div class=video-wrapper><iframe loading=lazy src=https://www.youtube.com/embed/WA_RL_QtIgY allowfullscreen title="YouTube Video"></iframe></div><p><em>Note:</em> If you want to comment on this article, please do so on the YouTube video.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/mtls/>mTLS</a>
<a href=/tags/tls/>TLS</a>
<a href=/tags/cyber-security/>Cyber Security</a>
<a href=/tags/hello-world/>Hello World</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/posts/using-c-and-go-with-cgo-is-tricky/><div class=article-image><img src=/posts/using-c-and-go-with-cgo-is-tricky/cgo-hello-world-fail.4dc7756d44340dd2d770d58e7e6e1628_hu_a2c12c8f3e9cc8ff.png width=250 height=150 loading=lazy alt="Featured image of post Using C and Go with CGO is tricky" data-hash="md5-Tcd1bUQ0DdLXcNWOfm4WKA=="></div><div class=article-details><h2 class=article-title>Using C and Go with CGO is tricky</h2></div></a></article><article class=has-image><a href=/posts/understanding-the-intricacies-of-fleet-policies/><div class=article-image><img src=/posts/understanding-the-intricacies-of-fleet-policies/understanding-the-intricacies-of-fleet-policies-main-policies-page-1999x978@2x.64cab4669deb2ae3cfcd074df178d0df_hu_86f73cc596f47b16.png width=250 height=150 loading=lazy alt="Featured image of post Understanding the intricacies of Fleet policies" data-hash="md5-ZMq0Zp3rKuPPzQdN8XjQ3w=="></div><div class=article-details><h2 class=article-title>Understanding the intricacies of Fleet policies</h2></div></a></article><article class=has-image><a href=/posts/get-current-telemetry-from-your-devices-with-live-queries/><div class=article-image><img src=/posts/get-current-telemetry-from-your-devices-with-live-queries/Live%20Query.b807967d303d64ce866304609285050a_hu_37717f2aa80e8b30.png width=250 height=150 loading=lazy alt="Featured image of post Get current telemetry from your devices with live queries" data-hash="md5-uAeWfTA9ZM6GYwRgkoUFCg=="></div><div class=article-details><h2 class=article-title>Get current telemetry from your devices with live queries</h2></div></a></article><article class=has-image><a href=/posts/physical-security-meets-cybersecurity-with-matter/><div class=article-image><img src=/posts/physical-security-meets-cybersecurity-with-matter/cover.5453e3320663c069954d9f6ec1a69403_hu_27c2621cfe0fd9e0.png width=250 height=150 loading=lazy alt="Featured image of post Physical security meets cybersecurity with Matter" data-hash="md5-VFPjMgZjwGmVTZ9uwaaUAw=="></div><div class=article-details><h2 class=article-title>Physical security meets cybersecurity with Matter</h2></div></a></article><article class=has-image><a href=/posts/setting-up-a-virtual-router/><div class=article-image><img src=/posts/setting-up-a-virtual-router/cover.8a38e07f00a8cdcbce7d27092cee5763_hu_fb18001c96e1e362.jpeg width=250 height=150 loading=lazy alt="Featured image of post Setting up a virtual router (pfSense on Proxmox)" data-hash="md5-ijjgfwCozcvOfScJLO5XYw=="></div><div class=article-details><h2 class=article-title>Setting up a virtual router (pfSense on Proxmox)</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2025 Victor on Software</section><section class=powerby></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>