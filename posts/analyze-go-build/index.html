<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="How to analyze and improve Go build compilation times"><title>How to analyze Go build times</title><link rel=canonical href=https://victoronsoftware.com/posts/analyze-go-build/><link rel=stylesheet href=/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css><meta property='og:title' content="How to analyze Go build times"><meta property='og:description' content="How to analyze and improve Go build compilation times"><meta property='og:url' content='https://victoronsoftware.com/posts/analyze-go-build/'><meta property='og:site_name' content='Victor on Software'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:tag' content='Golang'><meta property='article:tag' content='Developer Experience'><meta property='article:tag' content='Compiler'><meta property='article:published_time' content='2025-02-19T00:00:00+00:00'><meta property='article:modified_time' content='2025-02-19T00:00:00+00:00'><meta property='og:image' content='https://victoronsoftware.com/posts/analyze-go-build/analyze-go-build-headline.png'><meta property='article:author' content='Victor Lyuboslavsky'><meta name=twitter:title content="How to analyze Go build times"><meta name=twitter:description content="How to analyze and improve Go build compilation times"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://victoronsoftware.com/posts/analyze-go-build/analyze-go-build-headline.png'><script async src="https://www.googletagmanager.com/gtag/js?id=G-1XV381YSQ8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-1XV381YSQ8")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_c8fdb37897842f49.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Victor on Software</a></h1><h2 class=site-description>Software engineering, security, and related topics</h2></div></header><ol class=menu-social><li><a href=https://fleetdm.com target=_blank title=Fleet rel=me><svg width="58.219mm" height="58.202mm" viewBox="0 0 58.219 58.202"><g stroke-width=".26458"><path d="m7.5963 14.823c3.954.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2054-7.1594-7.1594-7.1594-3.954.0-7.1594 3.2053-7.1594 7.1594.0 3.954 3.2053 7.1594 7.1594 7.1594z" fill="#63c740"/><path d="m29.075 14.823c3.9539.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2054-7.1594-7.1594-7.1594-3.9541.0-7.1595 3.2053-7.1595 7.1594.0 3.954 3.2054 7.1594 7.1595 7.1594z" fill="#5cabdf"/><path d="m50.552 14.823c3.9542.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2052-7.1594-7.1594-7.1594-3.9539.0-7.1594 3.2053-7.1594 7.1594.0 3.954 3.2054 7.1594 7.1594 7.1594z" fill="#d66c7b"/><path d="m7.5963 36.301c3.954.0 7.1594-3.2054 7.1594-7.1594.0-3.9541-3.2054-7.1595-7.1594-7.1595-3.954.0-7.1594 3.2054-7.1594 7.1595.0 3.9539 3.2053 7.1594 7.1594 7.1594z" fill="#c98def"/><path d="m29.075 36.301c3.9539.0 7.1594-3.2054 7.1594-7.1594.0-3.9541-3.2054-7.1595-7.1594-7.1595-3.9541.0-7.1595 3.2054-7.1595 7.1595.0 3.9539 3.2054 7.1594 7.1595 7.1594z" fill="#faa669"/><path d="m7.5963 57.779c3.954.0 7.1594-3.2052 7.1594-7.1594.0-3.9539-3.2054-7.1594-7.1594-7.1594-3.954.0-7.1594 3.2054-7.1594 7.1594.0 3.9542 3.2053 7.1594 7.1594 7.1594z" fill="#3aefc4"/></g></svg></a></li><li><a href=https://github.com/getvictor target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/lyuboslavsky/ target=_blank title=LinkedIn rel=me><svg width="16" height="16" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16"><path d="M0 1.146C0 .513.526.0 1.175.0h13.65C15.474.0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487.0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401m-1.2-8.212c.837.0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822.0-1.359.54-1.359 1.248.0.694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869.0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274.0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54.0 01.016-.025V6.169h-2.4c.03.678.0 7.225.0 7.225h2.4"/></svg></a></li><li><a href=http://www.youtube.com/@VictorOnSoftware target=_blank title=YouTube rel=me><svg height="800" width="800" id="Layer_1" viewBox="0 0 461.001 461.001"><g><path style="fill:#f61c0d" d="M365.257 67.393H95.744C42.866 67.393.0 110.259.0 163.137v134.728c0 52.878 42.866 95.744 95.744 95.744h269.513c52.878.0 95.744-42.866 95.744-95.744V163.137c0-52.878-42.866-95.744-95.744-95.744zM300.506 237.056l-126.06 60.123c-3.359 1.602-7.239-.847-7.239-4.568V168.607c0-3.774 3.982-6.22 7.348-4.514l126.06 63.881C304.363 229.873 304.298 235.248 300.506 237.056z"/></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/page/speaking/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 2m0 3a3 3 0 013-3h0a3 3 0 013 3v5a3 3 0 01-3 3h0a3 3 0 01-3-3z"/><path d="M5 10a7 7 0 0014 0"/><path d="M8 21h8"/><path d="M12 17v4"/></svg>
<span>Speaking</span></a></li><li><a href=/page/tools/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Software tools</span></a></li><li><a href=/page/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/page/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/analyze-go-build/><img src=/posts/analyze-go-build/analyze-go-build-headline_hu_a51f94045f91dcd8.png srcset="/posts/analyze-go-build/analyze-go-build-headline_hu_a51f94045f91dcd8.png 800w, /posts/analyze-go-build/analyze-go-build-headline_hu_fe21cc2ea1c79b7f.png 1600w" width=800 height=419 loading=lazy alt="Featured image of post How to analyze Go build times"></a></div><div class=article-details><header class=article-category><a href=/categories/software-development/>Software Development</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/posts/analyze-go-build/>How to analyze Go build times</a></h2><h3 class=article-subtitle>How to analyze and improve Go build compilation times</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Feb 19, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>6 minute read</time></div></footer></div></header><section class=article-content><p>Go is designed for fast compilation. However, sometimes, you notice that your builds have gotten slower or that certain
code changes cause an unexpectedly long recompile time. In this article, we show how to analyze your compilation times
and take steps to improve them.</p><h2 id=turn-on-the-go-build-cache><a href=#turn-on-the-go-build-cache class=header-anchor></a>Turn on the Go build cache</h2><p>First, you must know that Go is very good at caching build artifacts. If you make a small change and rerun the build,
the rerun will be significantly faster because Go will reuse the cached artifacts from the previous build. However, if
you update the Go version, change the build flags, or pull in new or different dependencies, Go may rebuild everything
from scratch.</p><p>The first step in improving your build time is to make sure you are using a build cache. The cache is enabled by default
on your development machine, but that may not be true on your CI/CD system. Ensure you use a build cache across multiple
CI/CD runs. For example, the GitHub Actions
<a class=link href="https://github.com/actions/setup-go?tab=readme-ov-file#caching-dependency-files-and-build-outputs" target=_blank rel=noopener><code>setup-go</code> action has caching turned on by default</a>.</p><h2 id=analyze-a-go-build><a href=#analyze-a-go-build class=header-anchor></a>Analyze a Go build</h2><p>We can clear the build cache with the following:</p><pre tabindex=0><code>go clean -cache
</code></pre><p>Now, we can run a clean build with the <code>-debug-trace</code> flag:</p><pre tabindex=0><code>time go build -debug-trace=debug-trace.json ./cmd/fleet
</code></pre><p>We use the <code>time</code> command to measure the time the build takes. It is good practice to always use the <code>time</code> command when
measuring performance. The <code>time</code> command is built into our Z shell (zsh), but a similar command is available in other
shells and OSes.</p><p>In the time output, we see how long our build took:</p><pre tabindex=0><code>79.25s user 20.13s system 518% cpu 19.183 total
</code></pre><p>The total time (19.183s) is the wall clock time we waited for the build to finish. The user and system times are spent
executing user and system code. They are larger than the wall clock time because we use a multi-core machine.</p><p>The debug trace is in
<a class=link href=https://docs.google.com/document/d/1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU/preview target=_blank rel=noopener>Trace Event Format</a> and looks
like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>{<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;Running build command&#34;</span>,<span style=color:#f92672>&#34;ph&#34;</span>:<span style=color:#e6db74>&#34;B&#34;</span>,<span style=color:#f92672>&#34;ts&#34;</span>:<span style=color:#ae81ff>1739801608027038</span>,<span style=color:#f92672>&#34;pid&#34;</span>:<span style=color:#ae81ff>0</span>,<span style=color:#f92672>&#34;tid&#34;</span>:<span style=color:#ae81ff>0</span>}
</span></span><span style=display:flex><span>,{<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;load.PackagesAndErrors&#34;</span>,<span style=color:#f92672>&#34;ph&#34;</span>:<span style=color:#e6db74>&#34;B&#34;</span>,<span style=color:#f92672>&#34;ts&#34;</span>:<span style=color:#ae81ff>1739801608027222</span>,<span style=color:#f92672>&#34;pid&#34;</span>:<span style=color:#ae81ff>0</span>,<span style=color:#f92672>&#34;tid&#34;</span>:<span style=color:#ae81ff>0</span>}
</span></span><span style=display:flex><span>,{<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;modfetch.download github.com/WatchBeam/clock@v0.0.0-20170901150240-b08e6b4da7ea&#34;</span>,<span style=color:#f92672>&#34;ph&#34;</span>:<span style=color:#e6db74>&#34;B&#34;</span>,<span style=color:#f92672>&#34;ts&#34;</span>:<span style=color:#ae81ff>1739801608038996</span>,<span style=color:#f92672>&#34;pid&#34;</span>:<span style=color:#ae81ff>0</span>,<span style=color:#f92672>&#34;tid&#34;</span>:<span style=color:#ae81ff>0</span>}
</span></span><span style=display:flex><span>,{<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;modfetch.download github.com/WatchBeam/clock@v0.0.0-20170901150240-b08e6b4da7ea&#34;</span>,<span style=color:#f92672>&#34;ph&#34;</span>:<span style=color:#e6db74>&#34;E&#34;</span>,<span style=color:#f92672>&#34;ts&#34;</span>:<span style=color:#ae81ff>1739801608039035</span>,<span style=color:#f92672>&#34;pid&#34;</span>:<span style=color:#ae81ff>0</span>,<span style=color:#f92672>&#34;tid&#34;</span>:<span style=color:#ae81ff>0</span>}
</span></span><span style=display:flex><span>,{<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;modfetch.download github.com/briandowns/spinner@v1.23.1&#34;</span>,<span style=color:#f92672>&#34;ph&#34;</span>:<span style=color:#e6db74>&#34;B&#34;</span>,<span style=color:#f92672>&#34;ts&#34;</span>:<span style=color:#ae81ff>1739801608039382</span>,<span style=color:#f92672>&#34;pid&#34;</span>:<span style=color:#ae81ff>0</span>,<span style=color:#f92672>&#34;tid&#34;</span>:<span style=color:#ae81ff>0</span>}
</span></span><span style=display:flex><span>,{<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;modfetch.download github.com/briandowns/spinner@v1.23.1&#34;</span>,<span style=color:#f92672>&#34;ph&#34;</span>:<span style=color:#e6db74>&#34;E&#34;</span>,<span style=color:#f92672>&#34;ts&#34;</span>:<span style=color:#ae81ff>1739801608039410</span>,<span style=color:#f92672>&#34;pid&#34;</span>:<span style=color:#ae81ff>0</span>,<span style=color:#f92672>&#34;tid&#34;</span>:<span style=color:#ae81ff>0</span>}
</span></span><span style=display:flex><span>,{<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;modfetch.download github.com/e-dard/netbug@v0.0.0-20151029172837-e64d308a0b20&#34;</span>,<span style=color:#f92672>&#34;ph&#34;</span>:<span style=color:#e6db74>&#34;B&#34;</span>,<span style=color:#f92672>&#34;ts&#34;</span>:<span style=color:#ae81ff>1739801608039643</span>,<span style=color:#f92672>&#34;pid&#34;</span>:<span style=color:#ae81ff>0</span>,<span style=color:#f92672>&#34;tid&#34;</span>:<span style=color:#ae81ff>0</span>}
</span></span><span style=display:flex><span>,{<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;modfetch.download github.com/e-dard/netbug@v0.0.0-20151029172837-e64d308a0b20&#34;</span>,<span style=color:#f92672>&#34;ph&#34;</span>:<span style=color:#e6db74>&#34;E&#34;</span>,<span style=color:#f92672>&#34;ts&#34;</span>:<span style=color:#ae81ff>1739801608039808</span>,<span style=color:#f92672>&#34;pid&#34;</span>:<span style=color:#ae81ff>0</span>,<span style=color:#f92672>&#34;tid&#34;</span>:<span style=color:#ae81ff>0</span>}
</span></span><span style=display:flex><span>,{<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;modfetch.download github.com/getsentry/sentry-go@v0.18.0&#34;</span>,<span style=color:#f92672>&#34;ph&#34;</span>:<span style=color:#e6db74>&#34;B&#34;</span>,<span style=color:#f92672>&#34;ts&#34;</span>:<span style=color:#ae81ff>1739801608053496</span>,<span style=color:#f92672>&#34;pid&#34;</span>:<span style=color:#ae81ff>0</span>,<span style=color:#f92672>&#34;tid&#34;</span>:<span style=color:#ae81ff>0</span>}
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>...</span> <span style=color:#960050;background-color:#1e0010>and</span> <span style=color:#960050;background-color:#1e0010>so</span> <span style=color:#960050;background-color:#1e0010>on</span>
</span></span></code></pre></div><p>A widespread tool for visualizing Trace Event Format is <a class=link href=https://ui.perfetto.dev/ target=_blank rel=noopener>Perfetto</a>. Click <code>Open trace file</code>
and upload your trace. Use <code>Ctrl</code> + <code>Scroll</code> to zoom in and out and <code>Shift</code> + <code>Scroll</code> to move right or left. The <code>WASD</code>
keyboard keys also work.</p><figure><img src=/posts/analyze-go-build/debug-trace-clean.png><figcaption><h4>The Perfetto tool showing a Go build debug trace</h4></figcaption></figure><p>The trace shows that our <a class=link href=https://github.com/mattn/go-sqlite3 target=_blank rel=noopener>https://github.com/mattn/go-sqlite3</a> dependency is taking most of the build time. The fact that
we have 16 cores doesn&rsquo;t help because Go is not parallelizing the build for this dependency. This dependency uses CGO,
so the build takes time to compile C files.</p><p>We attempted to speed up the build by adding the <code>go-sqlite3</code> dependency to our top <code>./cmd/fleet</code> package, assuming the
build tool would start compiling it first. However, the total build took longer because the subsequent link step became
much slower.</p><p>As we mentioned above, the initial compile time is usually not a big concern if you are using a build cache. So, let&rsquo;s
try making a small change and analyzing the recompile time. We make a change to a frequently modified package.</p><pre tabindex=0><code>echo &#39;var _ = &#34;bozo&#34;&#39; &gt;&gt; ./server/datastore/mysql/mysql.go
time go build -debug-trace=debug-trace-recompile.json ./cmd/fleet
</code></pre><p>The total recompile time is 1.229s, and the trace looks like this:</p><figure><img src=/posts/analyze-go-build/debug-trace-recompile.png><figcaption><h4>The Perfetto tool showing a Go recompile debug trace</h4></figcaption></figure><p>We see that the <code>mysql</code> package we modified is taking about half the recompile time. The <code>load.PackagesAndErrors</code> step
takes ~300ms and is not parallelized. This step is part of the Go toolchain. Modifying a smaller package would reduce
the recompile time. If you have a large package that is frequently modified, you can improve the build time by splitting
it into smaller packages.</p><h2 id=find-why-dependencies><a href=#find-why-dependencies class=header-anchor></a>Find why dependencies are included in the build</h2><p>In a previous article, we described <a class=link href=../go-package-dependencies>how to find Go package dependencies</a>. A way to analyze
the build and see why a dependency is being pulled in is to use the <code>-debug-actiongraph</code> flag:</p><pre tabindex=0><code>go clean -cache
time go build -debug-actiongraph=actiongraph.json ./cmd/fleet
</code></pre><p>The resulting <code>actiongraph.json</code> is a JSON file containing an array of entries such as:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ID&#34;</span>: <span style=color:#ae81ff>27</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Mode&#34;</span>: <span style=color:#e6db74>&#34;build&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Package&#34;</span>: <span style=color:#e6db74>&#34;github.com/fleetdm/fleet/v4/server/datastore/filesystem&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Deps&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>4</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>11</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>23</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>33</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>93</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>97</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>180</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>103</span>
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Objdir&#34;</span>: <span style=color:#e6db74>&#34;/var/folders/r6/br06kz3s6lxb_75zz6dkjvvc0000gn/T/go-build3105381437/b845/&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Priority&#34;</span>: <span style=color:#ae81ff>843</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;NeedBuild&#34;</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ActionID&#34;</span>: <span style=color:#e6db74>&#34;JGOAJdypDJJbwlHvaUPE&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;BuildID&#34;</span>: <span style=color:#e6db74>&#34;JGOAJdypDJJbwlHvaUPE/B47ZHL3FCDKdll6TubU2&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;TimeReady&#34;</span>: <span style=color:#e6db74>&#34;2025-02-18T09:02:54.257806-06:00&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;TimeStart&#34;</span>: <span style=color:#e6db74>&#34;2025-02-18T09:02:54.272756-06:00&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;TimeDone&#34;</span>: <span style=color:#e6db74>&#34;2025-02-18T09:02:54.293356-06:00&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Cmd&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;/opt/homebrew/Cellar/go/1.23.4/libexec/pkg/tool/darwin_arm64/compile -o /var/folders/r6/br06kz3s6lxb_75zz6dkjvvc0000gn/T/go-build3105381437/b845/_pkg_.a -trimpath \&#34;/var/folders/r6/br06kz3s6lxb_75zz6dkjvvc0000gn/T/go-build3105381437/b845=\u003e\&#34; -p github.com/fleetdm/fleet/v4/server/datastore/filesystem -lang=go1.23 -complete -buildid JGOAJdypDJJbwlHvaUPE/JGOAJdypDJJbwlHvaUPE -goversion go1.23.4 -c=4 -shared -nolocalimports -importcfg /var/folders/r6/br06kz3s6lxb_75zz6dkjvvc0000gn/T/go-build3105381437/b845/importcfg -pack /Users/victor/work/fleet/server/datastore/filesystem/software_installer.go&#34;</span>
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;CmdReal&#34;</span>: <span style=color:#ae81ff>17479792</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;CmdUser&#34;</span>: <span style=color:#ae81ff>17327000</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;CmdSys&#34;</span>: <span style=color:#ae81ff>5692000</span>
</span></span><span style=display:flex><span>}<span style=color:#960050;background-color:#1e0010>,</span>
</span></span></code></pre></div><p>The <code>CmdReal</code>, <code>CmdUser</code>, and <code>CmdSys</code> fields show the real, user, and system time spent executing the command. The
<code>Deps</code> field shows the package&rsquo;s dependencies.</p><p>Although we can write our own tool to analyze the <code>actiongraph.json</code> file, we can also use the
<a class=link href=https://github.com/icio/actiongraph target=_blank rel=noopener>https://github.com/icio/actiongraph</a> tool. Install the tool with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go install github.com/icio/actiongraph@latest
</span></span></code></pre></div><p>We can find the longest compile steps with:</p><pre tabindex=0><code>actiongraph -f actiongraph.json top
 13.786s  16.14%  build github.com/mattn/go-sqlite3
  1.396s  17.78%  build runtime/cgo
  1.327s  19.33%  build github.com/aws/aws-sdk-go/service/s3
  1.295s  20.85%  build github.com/aws/aws-sdk-go/aws/endpoints
  1.095s  22.13%  build github.com/google/go-github/v37/github
  1.078s  23.39%  build github.com/elastic/go-sysinfo/providers/darwin
  0.983s  24.55%  build github.com/open-policy-agent/opa/ast
  0.975s  25.69%  build github.com/klauspost/compress/zstd
  0.916s  26.76%  build github.com/shoenig/go-m1cpu
  0.755s  27.64%  build crypto/tls
  0.742s  28.51%  build github.com/fleetdm/fleet/v4/server/fleet
  0.722s  29.36%  build github.com/shirou/gopsutil/v3/process
  0.664s  30.14%  build net
  0.626s  30.87%  build github.com/open-policy-agent/opa/topdown
  0.625s  31.60%  build runtime
  0.622s  32.33%  build google.golang.org/protobuf/internal/impl
  0.609s  33.04%  build github.com/fleetdm/fleet/v4/server/datastore/mysql
  0.605s  33.75%  build golang.org/x/net/http2
  0.577s  34.43%  build github.com/aws/aws-sdk-go/service/lambda
  0.576s  35.10%  build github.com/spf13/pflag
</code></pre><p>The tool also has a <code>graph</code> subcommand to highlight all import paths from the build target to the package indicated by
<code>--why</code>. We can convert the <code>.dot</code> file to an SVG file with the <a class=link href=https://graphviz.org/ target=_blank rel=noopener>Graphviz</a> <code>dot</code> command.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>actiongraph -f actiongraph.json graph --why github.com/mattn/go-sqlite3 &gt; actiongraph-sqlite3.dot
</span></span><span style=display:flex><span>dot -Tsvg &lt; actiongraph-sqlite3.dot &gt; actiongraph-sqlite3.svg
</span></span></code></pre></div><figure><img src=/posts/analyze-go-build/actiongraph-sqlite3.svg><figcaption><h4>Why the go-sqlite3 package is included in the build</h4></figcaption></figure><p>We can use this knowledge to refactor the codebase or, perhaps, hide the problematic dependency behind a build flag.</p><p>There is no official documentation for the above debug flags. However, they can be found in the
<a class=link href=https://go.dev/src/cmd/go/internal/work/build.go target=_blank rel=noopener>Go source code</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>    <span style=color:#75715e>// Undocumented, unstable debugging flags.</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Flag</span>.<span style=color:#a6e22e>StringVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>cfg</span>.<span style=color:#a6e22e>DebugActiongraph</span>, <span style=color:#e6db74>&#34;debug-actiongraph&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Flag</span>.<span style=color:#a6e22e>StringVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>cfg</span>.<span style=color:#a6e22e>DebugRuntimeTrace</span>, <span style=color:#e6db74>&#34;debug-runtime-trace&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Flag</span>.<span style=color:#a6e22e>StringVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>cfg</span>.<span style=color:#a6e22e>DebugTrace</span>, <span style=color:#e6db74>&#34;debug-trace&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)
</span></span></code></pre></div><h2 id=further-reading><a href=#further-reading class=header-anchor></a>Further reading</h2><ul><li>Previously, we explained <a class=link href=../go-test-execution-time/>how to accurately measure the execution time of Go tests</a> and
<a class=link href=../large-go-test-suite/>how to break apart a large Go test suite</a>.</li><li>We also <a class=link href=../common-refactorings/>demonstrated some common code refactorings that can be done with your IDE</a>.</li></ul><h2 id=watch-how-to-analyze-go-builds><a href=#watch-how-to-analyze-go-builds class=header-anchor></a>Watch how to analyze Go builds</h2><div class=video-wrapper><iframe loading=lazy src=https://www.youtube.com/embed/fs81KvxhwhI allowfullscreen title="YouTube Video"></iframe></div><p><em>Note:</em> If you want to comment on this article, please do so on the YouTube video.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/golang/>Golang</a>
<a href=/tags/developer-experience/>Developer Experience</a>
<a href=/tags/compiler/>Compiler</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/posts/go-test-execution-time/><div class=article-image><img src=/posts/go-test-execution-time/crash-test-dummy-headline.b52944a60a898bc6ca376849bf1212e9_hu_f927f9af09a65a7b.png width=250 height=150 loading=lazy alt="Featured image of post How to measure the execution time of Go tests accurately" data-hash="md5-tSlEpgqJi8bKN2hJvxIS6Q=="></div><div class=article-details><h2 class=article-title>How to measure the execution time of Go tests accurately</h2></div></a></article><article class=has-image><a href=/posts/common-refactorings/><div class=article-image><img src=/posts/common-refactorings/common-refactorings-headline.ecb44b01a213ac7baa3dd2826d9d548a_hu_581753d9f1fe7af.png width=250 height=150 loading=lazy alt="Featured image of post Top code refactorings every software engineer should know" data-hash="md5-7LRLAaITrHuqPdKCbZ1Uig=="></div><div class=article-details><h2 class=article-title>Top code refactorings every software engineer should know</h2></div></a></article><article class=has-image><a href=/posts/go-package-dependencies/><div class=article-image><img src=/posts/go-package-dependencies/go-dependencies-headline.5b98aa5d1633408c72b8ea3bc653a503_hu_83e01245d284a0d1.png width=250 height=150 loading=lazy alt="Featured image of post How to find package dependencies of a Go package" data-hash="md5-W5iqXRYzQIxyuOo7xlOlAw=="></div><div class=article-details><h2 class=article-title>How to find package dependencies of a Go package</h2></div></a></article><article class=has-image><a href=/posts/scaling-codebase-evolutionary-architecture/><div class=article-image><img src=/posts/scaling-codebase-evolutionary-architecture/evolutionary-architecture-headline.0294abfc9580dc6be68388bfd3992dbf_hu_890053f752f5979e.png width=250 height=150 loading=lazy alt="Featured image of post How to scale your codebase with evolutionary architecture" data-hash="md5-ApSr/JWA3Gvmg4i/05ktvw=="></div><div class=article-details><h2 class=article-title>How to scale your codebase with evolutionary architecture</h2></div></a></article><article class=has-image><a href=/posts/readable-code/><div class=article-image><img src=/posts/readable-code/readable-code-headline.bc9bdbf58833c0b12da94a4813ce4846_hu_3569583f60d536aa.png width=250 height=150 loading=lazy alt="Featured image of post What is readable code and why is it important?" data-hash="md5-vJvb9YgzwLEtqUpIE85IRg=="></div><div class=article-details><h2 class=article-title>What is readable code and why is it important?</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2025 Victor on Software</section><section class=powerby></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>