<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Common issues with Unicode and emoji support"><title>Fully supporting Unicode and emojis in your app</title><link rel=canonical href=https://victoronsoftware.com/posts/unicode-and-emoji-gotchas/><link rel=stylesheet href=/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css><meta property='og:title' content="Fully supporting Unicode and emojis in your app"><meta property='og:description' content="Common issues with Unicode and emoji support"><meta property='og:url' content='https://victoronsoftware.com/posts/unicode-and-emoji-gotchas/'><meta property='og:site_name' content='Victor on Software'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:tag' content='Unicode'><meta property='article:tag' content='Emoji'><meta property='article:tag' content='MySQL'><meta property='article:published_time' content='2024-02-29T00:00:00+00:00'><meta property='article:modified_time' content='2024-02-29T00:00:00+00:00'><meta property='og:image' content='https://victoronsoftware.com/posts/unicode-and-emoji-gotchas/unicode-emoji.png'><meta name=twitter:title content="Fully supporting Unicode and emojis in your app"><meta name=twitter:description content="Common issues with Unicode and emoji support"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://victoronsoftware.com/posts/unicode-and-emoji-gotchas/unicode-emoji.png'><script async src="https://www.googletagmanager.com/gtag/js?id=G-1XV381YSQ8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-1XV381YSQ8")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_c8fdb37897842f49.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Victor on Software</a></h1><h2 class=site-description>Software engineering, security, and related topics</h2></div></header><ol class=menu-social><li><a href=https://fleetdm.com target=_blank title=Fleet rel=me><svg width="58.219mm" height="58.202mm" viewBox="0 0 58.219 58.202"><g stroke-width=".26458"><path d="m7.5963 14.823c3.954.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2054-7.1594-7.1594-7.1594-3.954.0-7.1594 3.2053-7.1594 7.1594.0 3.954 3.2053 7.1594 7.1594 7.1594z" fill="#63c740"/><path d="m29.075 14.823c3.9539.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2054-7.1594-7.1594-7.1594-3.9541.0-7.1595 3.2053-7.1595 7.1594.0 3.954 3.2054 7.1594 7.1595 7.1594z" fill="#5cabdf"/><path d="m50.552 14.823c3.9542.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2052-7.1594-7.1594-7.1594-3.9539.0-7.1594 3.2053-7.1594 7.1594.0 3.954 3.2054 7.1594 7.1594 7.1594z" fill="#d66c7b"/><path d="m7.5963 36.301c3.954.0 7.1594-3.2054 7.1594-7.1594.0-3.9541-3.2054-7.1595-7.1594-7.1595-3.954.0-7.1594 3.2054-7.1594 7.1595.0 3.9539 3.2053 7.1594 7.1594 7.1594z" fill="#c98def"/><path d="m29.075 36.301c3.9539.0 7.1594-3.2054 7.1594-7.1594.0-3.9541-3.2054-7.1595-7.1594-7.1595-3.9541.0-7.1595 3.2054-7.1595 7.1595.0 3.9539 3.2054 7.1594 7.1595 7.1594z" fill="#faa669"/><path d="m7.5963 57.779c3.954.0 7.1594-3.2052 7.1594-7.1594.0-3.9539-3.2054-7.1594-7.1594-7.1594-3.954.0-7.1594 3.2054-7.1594 7.1594.0 3.9542 3.2053 7.1594 7.1594 7.1594z" fill="#3aefc4"/></g></svg></a></li><li><a href=https://github.com/getvictor target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/lyuboslavsky/ target=_blank title=LinkedIn rel=me><svg width="16" height="16" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16"><path d="M0 1.146C0 .513.526.0 1.175.0h13.65C15.474.0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487.0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401m-1.2-8.212c.837.0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822.0-1.359.54-1.359 1.248.0.694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869.0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274.0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54.0 01.016-.025V6.169h-2.4c.03.678.0 7.225.0 7.225h2.4"/></svg></a></li><li><a href=http://www.youtube.com/@VictorOnSoftware target=_blank title=YouTube rel=me><svg height="800" width="800" id="Layer_1" viewBox="0 0 461.001 461.001"><g><path style="fill:#f61c0d" d="M365.257 67.393H95.744C42.866 67.393.0 110.259.0 163.137v134.728c0 52.878 42.866 95.744 95.744 95.744h269.513c52.878.0 95.744-42.866 95.744-95.744V163.137c0-52.878-42.866-95.744-95.744-95.744zM300.506 237.056l-126.06 60.123c-3.359 1.602-7.239-.847-7.239-4.568V168.607c0-3.774 3.982-6.22 7.348-4.514l126.06 63.881C304.363 229.873 304.298 235.248 300.506 237.056z"/></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/page/tools/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Software tools</span></a></li><li><a href=/page/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/page/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/unicode-and-emoji-gotchas/><img src=/posts/unicode-and-emoji-gotchas/unicode-emoji_hu_68c0d7b49dff485d.png srcset="/posts/unicode-and-emoji-gotchas/unicode-emoji_hu_68c0d7b49dff485d.png 800w, /posts/unicode-and-emoji-gotchas/unicode-emoji_hu_720b6499510610f9.png 1600w" width=800 height=450 loading=lazy alt="Featured image of post Fully supporting Unicode and emojis in your app"></a></div><div class=article-details><header class=article-category><a href=/categories/database-administration/>Database Administration
</a><a href=/categories/software-development/>Software Development</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/posts/unicode-and-emoji-gotchas/>Fully supporting Unicode and emojis in your app</a></h2><h3 class=article-subtitle>Common issues with Unicode and emoji support</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Feb 29, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><h2 id=introduction><a href=#introduction class=header-anchor></a>Introduction</h2><p>Any app aiming to reach an international audience must support Unicode. Emojis, which are based on Unicode, are everywhere. They are used in text messages, social media, and programming languages. Supporting Unicode and emojis in your app can be tricky. This article will cover common Unicode and emoji support issues and how to fix them.</p><h2 id=what-is-unicode><a href=#what-is-unicode class=header-anchor></a>What is Unicode?</h2><p>Unicode is a standard for encoding, representing, and handling text. It is a character set that assigns a unique number to every character. The most common encoding for Unicode is UTF-8, which stands for Unicode Transformation Format 8-bit. UTF-8 is a variable-width encoding that can represent every character in the Unicode character set.</p><p>UTF-8 format can take one to four bytes to represent a code point. Multiple code points can be combined to form a single character. For example, the emoji &ldquo;üëç&rdquo; is represented by the code point <code>U+1F44D</code>. In UTF-8, it is represented by the bytes <code>F0 9F 91 8D</code>. The same emoji with skin tone &ldquo;üëçüèΩ&rdquo; is represented by the code point <code>U+1F44D U+1F3FD</code>. In UTF-8, that emoji is represented by the bytes <code>F0 9F 91 8D F0 9F 8F BD</code>. Generally, emojis take up at least four bytes in UTF-8.</p><h2 id=unicode-equivalence><a href=#unicode-equivalence class=header-anchor></a>Unicode equivalence</h2><p>Our first gotcha is unicode equivalence.</p><p>Unicode equivalence is the concept that two different sequences of code points can represent the same character. For example, the character <code>√©</code> can be represented by the code point <code>U+00E9</code> or by the sequence of code points <code>U+0065 U+0301</code>. The first representation is the composed form, and the second is the decomposed form. Unicode equivalence is essential when comparing strings or searching for a string character.</p><p>Databases typically do not support Unicode equivalence out of the box. For example, given this table using MySQL 5.7:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> test (
</span></span><span style=display:flex><span>    id INT UNSIGNED <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> AUTO_INCREMENT,
</span></span><span style=display:flex><span>    name VARCHAR(<span style=color:#ae81ff>255</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (id))
</span></span><span style=display:flex><span>    CHARACTER <span style=color:#66d9ef>SET</span> utf8mb4 <span style=color:#66d9ef>COLLATE</span> utf8mb4_unicode_ci;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> test (name) <span style=color:#66d9ef>VALUES</span> (<span style=color:#e6db74>&#39;Í∞Ä&#39;</span>), (CONCAT(<span style=color:#e6db74>&#39;·ÑÄ&#39;</span>, <span style=color:#e6db74>&#39;·Ö°&#39;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> test <span style=color:#66d9ef>WHERE</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Í∞Ä&#39;</span>;
</span></span></code></pre></div><p>The query will return a single row, even though the Korean character <code>Í∞Ä</code> and character sequence <code>·ÑÄ</code> + <code>·Ö°</code> are equivalent. The incorrect result is because the <code>utf8mb4_unicode_ci</code> collation does not support Unicode equivalence. One way to fix this is to use the <code>utf8mb4_0900_ai_ci</code> collation, which supports Unicode equivalence. However, this requires updating the database to MySQL 8.0 or later, which may not be possible in some cases.</p><h2 id=emoji-equivalence><a href=#emoji-equivalence class=header-anchor></a>Emoji equivalence</h2><p>Our second gotcha is emoji equivalence.</p><p>Some databases may not support emoji equivalence out of the box. For example, given this table using MySQL 5.7:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> test (
</span></span><span style=display:flex><span>    id INT UNSIGNED <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> AUTO_INCREMENT,
</span></span><span style=display:flex><span>    name VARCHAR(<span style=color:#ae81ff>255</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (id))
</span></span><span style=display:flex><span>    CHARACTER <span style=color:#66d9ef>SET</span> utf8mb4 <span style=color:#66d9ef>COLLATE</span> utf8mb4_unicode_ci;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> test (name) <span style=color:#66d9ef>VALUES</span> (<span style=color:#e6db74>&#39;üî•&#39;</span>), (<span style=color:#e6db74>&#39;üî•üî•&#39;</span>), (<span style=color:#e6db74>&#39;üëç&#39;</span>), (<span style=color:#e6db74>&#39;üëçüèΩ&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> test <span style=color:#66d9ef>WHERE</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;üî•&#39;</span>;
</span></span></code></pre></div><p>The query will return:</p><pre tabindex=0><code>1,üî•
3,üëç
</code></pre><p>And the following query:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> test <span style=color:#66d9ef>WHERE</span> name <span style=color:#66d9ef>LIKE</span> <span style=color:#e6db74>&#39;%üî•%&#39;</span>;
</span></span></code></pre></div><p>Will return:</p><pre tabindex=0><code>1,üî•
2,üî•üî•
</code></pre><p>The <code>utf8mb4_unicode_ci</code> collation does not support emoji equivalence, and the behavior of <code>=</code> differs from <code>LIKE.</code></p><p>One way to fix the problem of emoji equivalence is to use a different collation during the <code>=</code> comparison. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> test <span style=color:#66d9ef>WHERE</span> name <span style=color:#66d9ef>COLLATE</span> utf8mb4_bin <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;üî•&#39;</span>;
</span></span></code></pre></div><p>Will return the single correct result:</p><pre tabindex=0><code>1,üî•
</code></pre><p>However, this solution is not ideal because it requires the developer to remember to use the <code>utf8mb4_bin</code> collation for emoji equivalence. There is also a slight performance impact when using a different collation.</p><h2 id=case-insensitive-sorting><a href=#case-insensitive-sorting class=header-anchor></a>Case-insensitive sorting</h2><p>Our third gotcha is sorting.</p><p>Typically, app users want to see case-insensitive sorting of strings. For example, the strings &ldquo;apple&rdquo;, &ldquo;Banana&rdquo;, and &ldquo;cherry&rdquo; should be sorted as &ldquo;apple&rdquo;, &ldquo;Banana&rdquo;, and &ldquo;cherry&rdquo;. The <code>utf8mb4_unicode_ci</code> collation used above supports case-insensitive sorting. However, switching to another collation, such as <code>utf8mb4_bin</code>, to support emoji equivalence will break case-insensitive sorting. Hence, whatever solution you develop for full Unicode support should also support case-insensitive sorting.</p><h2 id=solving-our-gotchas-with-normalization><a href=#solving-our-gotchas-with-normalization class=header-anchor></a>Solving our gotchas with normalization</h2><p>A partial solution to the above gotchas is to use normalization. Normalization is the process of transforming text into a standard form. Unicode defines four normalization forms: NFC, NFD, NFKC, and NFKD. The most common normalization form is NFC, which is the composed form. NFC is the standard form for most text processing.</p><p>For example, in the following Go code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;golang.org/x/text/unicode/norm&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;strconv&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>str1</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>Unquote</span>(<span style=color:#e6db74>`&#34;\uAC00&#34;`</span>)       <span style=color:#75715e>// Í∞Ä</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>str2</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>Unquote</span>(<span style=color:#e6db74>`&#34;\u1100\u1161&#34;`</span>) <span style=color:#75715e>// ·ÑÄ + ·Ö°</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>str1</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>str2</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>str1</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>str2</span> {
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;raw equal&#34;</span>)
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;raw not equal&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>strNorm1</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>norm</span>.<span style=color:#a6e22e>NFC</span>.<span style=color:#a6e22e>String</span>(<span style=color:#a6e22e>str1</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>strNorm2</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>norm</span>.<span style=color:#a6e22e>NFC</span>.<span style=color:#a6e22e>String</span>(<span style=color:#a6e22e>str2</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>strNorm1</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>strNorm2</span> {
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;normalized equal&#34;</span>)
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;normalized not equal&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The two strings are not equal in their raw form but equal after normalization. Normalizing before inserting, updating, and searching in the database can solve the Unicode equivalence issue while allowing the user to keep the case-insensitive sorting.</p><p>To solve emoji equivalence, we can use the <code>utf8mb4_bin</code> collation for the <code>=</code> comparison. However, if our column is indexed, we may need to use the <code>utf8mb4_bin</code> collation for the index. We cannot have a different collation for the column and the index, but we could use a second generated column with the <code>utf8mb4_bin</code> collation and index that column.</p><h2 id=conclusion><a href=#conclusion class=header-anchor></a>Conclusion</h2><p>Unicode and emoji support is essential for any app aiming to reach an international audience. Unicode equivalence, emoji equivalence, and case-insensitive sorting are common issues with Unicode and emoji support. Normalization can solve the Unicode equivalence issue while allowing the user to keep the case-insensitive sorting. Using the <code>utf8mb4_bin</code> collation for the <code>=</code> comparison can solve the emoji equivalence issue.</p><h2 id=fully-supporting-unicode-and-emojis-in-your-app-video><a href=#fully-supporting-unicode-and-emojis-in-your-app-video class=header-anchor></a>Fully supporting Unicode and emojis in your app video</h2><div class=video-wrapper><iframe loading=lazy src=https://www.youtube.com/embed/u9jFFHifa0Q allowfullscreen title="YouTube Video"></iframe></div><h2 id=other-articles-related-to-mysql><a href=#other-articles-related-to-mysql class=header-anchor></a>Other articles related to MySQL</h2><ul><li><a class=link href=../mysql-query-performance-insert-subqueries/>Optimize MySQL query performance: INSERT with subqueries</a></li><li><a class=link href=../mysql-upsert-deadlock/>MySQL deadlock on UPDATE/INSERT upsert pattern</a></li><li><a class=link href=../sql-prepared-statements-are-broken-when-scaling-applications/>SQL prepared statements are broken when scaling applications</a></li></ul><p><em>Note:</em> If you want to comment on this article, please do so on the YouTube video.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/unicode/>Unicode</a>
<a href=/tags/emoji/>Emoji</a>
<a href=/tags/mysql/>MySQL</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/posts/sql-prepared-statements-are-broken-when-scaling-applications/><div class=article-image><img src=/posts/sql-prepared-statements-are-broken-when-scaling-applications/cover.eafd31b48e2454f1eec208dbae83a4f6_hu_da087ce6227ee4c9.png width=250 height=150 loading=lazy alt="Featured image of post SQL prepared statements are broken when scaling applications" data-hash="md5-6v0xtI4kVPHuwgjbroOk9g=="></div><div class=article-details><h2 class=article-title>SQL prepared statements are broken when scaling applications</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2025 Victor on Software</section><section class=powerby></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>