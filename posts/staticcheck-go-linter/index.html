<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="First impressions enabling the staticcheck linter in our large Go application"><title>Is staticcheck linter useful for my Go project?</title><link rel=canonical href=https://victoronsoftware.com/posts/staticcheck-go-linter/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="Is staticcheck linter useful for my Go project?"><meta property='og:description' content="First impressions enabling the staticcheck linter in our large Go application"><meta property='og:url' content='https://victoronsoftware.com/posts/staticcheck-go-linter/'><meta property='og:site_name' content='Victor on Software'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:tag' content='DevTools'><meta property='article:tag' content='Golang'><meta property='article:tag' content='Linting'><meta property='article:published_time' content='2024-11-06T00:00:00+00:00'><meta property='article:modified_time' content='2024-11-06T00:00:00+00:00'><meta property='og:image' content='https://victoronsoftware.com/posts/staticcheck-go-linter/staticcheck-go-linter-headline.png'><meta property='article:author' content='Victor Lyuboslavsky'><meta name=twitter:title content="Is staticcheck linter useful for my Go project?"><meta name=twitter:description content="First impressions enabling the staticcheck linter in our large Go application"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://victoronsoftware.com/posts/staticcheck-go-linter/staticcheck-go-linter-headline.png'><script async src="https://www.googletagmanager.com/gtag/js?id=G-1XV381YSQ8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-1XV381YSQ8")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_c8fdb37897842f49.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Victor on Software</a></h1><h2 class=site-description>Software engineering, security, and related topics</h2></div></header><ol class=menu-social><li><a href=https://fleetdm.com target=_blank title=Fleet rel=me><svg width="58.219mm" height="58.202mm" viewBox="0 0 58.219 58.202"><g stroke-width=".26458"><path d="m7.5963 14.823c3.954.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2054-7.1594-7.1594-7.1594-3.954.0-7.1594 3.2053-7.1594 7.1594.0 3.954 3.2053 7.1594 7.1594 7.1594z" fill="#63c740"/><path d="m29.075 14.823c3.9539.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2054-7.1594-7.1594-7.1594-3.9541.0-7.1595 3.2053-7.1595 7.1594.0 3.954 3.2054 7.1594 7.1595 7.1594z" fill="#5cabdf"/><path d="m50.552 14.823c3.9542.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2052-7.1594-7.1594-7.1594-3.9539.0-7.1594 3.2053-7.1594 7.1594.0 3.954 3.2054 7.1594 7.1594 7.1594z" fill="#d66c7b"/><path d="m7.5963 36.301c3.954.0 7.1594-3.2054 7.1594-7.1594.0-3.9541-3.2054-7.1595-7.1594-7.1595-3.954.0-7.1594 3.2054-7.1594 7.1595.0 3.9539 3.2053 7.1594 7.1594 7.1594z" fill="#c98def"/><path d="m29.075 36.301c3.9539.0 7.1594-3.2054 7.1594-7.1594.0-3.9541-3.2054-7.1595-7.1594-7.1595-3.9541.0-7.1595 3.2054-7.1595 7.1595.0 3.9539 3.2054 7.1594 7.1595 7.1594z" fill="#faa669"/><path d="m7.5963 57.779c3.954.0 7.1594-3.2052 7.1594-7.1594.0-3.9539-3.2054-7.1594-7.1594-7.1594-3.954.0-7.1594 3.2054-7.1594 7.1594.0 3.9542 3.2053 7.1594 7.1594 7.1594z" fill="#3aefc4"/></g></svg></a></li><li><a href=https://github.com/getvictor target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/lyuboslavsky/ target=_blank title=LinkedIn rel=me><svg width="16" height="16" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16"><path d="M0 1.146C0 .513.526.0 1.175.0h13.65C15.474.0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487.0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401m-1.2-8.212c.837.0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822.0-1.359.54-1.359 1.248.0.694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869.0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274.0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54.0 01.016-.025V6.169h-2.4c.03.678.0 7.225.0 7.225h2.4"/></svg></a></li><li><a href=http://www.youtube.com/@VictorOnSoftware target=_blank title=YouTube rel=me><svg height="800" width="800" id="Layer_1" viewBox="0 0 461.001 461.001"><g><path style="fill:#f61c0d" d="M365.257 67.393H95.744C42.866 67.393.0 110.259.0 163.137v134.728c0 52.878 42.866 95.744 95.744 95.744h269.513c52.878.0 95.744-42.866 95.744-95.744V163.137c0-52.878-42.866-95.744-95.744-95.744zM300.506 237.056l-126.06 60.123c-3.359 1.602-7.239-.847-7.239-4.568V168.607c0-3.774 3.982-6.22 7.348-4.514l126.06 63.881C304.363 229.873 304.298 235.248 300.506 237.056z"/></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/page/speaking/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 2m0 3a3 3 0 013-3h0a3 3 0 013 3v5a3 3 0 01-3 3h0a3 3 0 01-3-3z"/><path d="M5 10a7 7 0 0014 0"/><path d="M8 21h8"/><path d="M12 17v4"/></svg>
<span>Speaking</span></a></li><li><a href=/page/tools/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Software tools</span></a></li><li><a href=/page/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/page/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/staticcheck-go-linter/><img src=/posts/staticcheck-go-linter/staticcheck-go-linter-headline_hu_fa24a22415e73267.png srcset="/posts/staticcheck-go-linter/staticcheck-go-linter-headline_hu_fa24a22415e73267.png 800w, /posts/staticcheck-go-linter/staticcheck-go-linter-headline_hu_7fcb58262effe613.png 1600w" width=800 height=419 loading=lazy alt="Featured image of post Is staticcheck linter useful for my Go project?"></a></div><div class=article-details><header class=article-category><a href=/categories/software-development/>Software Development</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/posts/staticcheck-go-linter/>Is staticcheck linter useful for my Go project?</a></h2><h3 class=article-subtitle>First impressions enabling the staticcheck linter in our large Go application</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Nov 06, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>6 minute read</time></div></footer></div></header><section class=article-content><h2 id=what-is-staticcheck><a href=#what-is-staticcheck class=header-anchor></a>What is staticcheck?</h2><p><a class=link href=https://staticcheck.dev/ target=_blank rel=noopener>Staticcheck</a> is a Go linter that checks your Go code for bugs and performance issues. It is a
powerful tool that can help you find issues in your code before they become problematic. Staticcheck is one of the
default linters in the <a class=link href=https://golangci-lint.run/ target=_blank rel=noopener>golangci-lint</a> tool.</p><h2 id=run-staticcheck-on-your-go-project><a href=#run-staticcheck-on-your-go-project class=header-anchor></a>Run staticcheck on your Go project</h2><p>In this example, we will enable staticcheck via the <code>golangci-lint</code> tool in a large Go project. The <code>golangci-lint</code> tool
is a lint runner that runs many linters in parallel. It is a great tool to use in your CI/CD pipeline to catch issues
early.</p><h3 id=install-golangci-lint><a href=#install-golangci-lint class=header-anchor></a>Install golangci-lint</h3><p>To install the <code>golangci-lint</code> tool, you can use one of the options in
<a class=link href=https://golangci-lint.run/welcome/install/ target=_blank rel=noopener>golangci-lint install documentation</a>. We install it using the following
command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go install github.com/golangci/golangci-lint/cmd/golangci-lint@v1.61.0
</span></span></code></pre></div><p>Although the documentation does not recommend this way of installing from source, we use it to ensure that our version
of <code>golangci-lint</code> is compiled using the same Go version as our project. We previously encountered issues with
<code>golangci-lint</code> compiled with a different Go version.</p><p>Check the version of <code>golangci-lint</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>golangci-lint --version
</span></span></code></pre></div><p>Sample output:</p><pre tabindex=0><code>golangci-lint has version v1.61.0 built with go1.23.1 from (unknown, modified: ?, mod sum: &#34;h1:VvbOLaRVWmyxCnUIMTbf1kDsaJbTzH20FAMXTAlQGu8=&#34;) on (unknown)
</code></pre><h3 id=run-golangci-lint-with-staticcheck><a href=#run-golangci-lint-with-staticcheck class=header-anchor></a>Run golangci-lint with staticcheck</h3><p>You can run <code>staticcheck</code> using the <code>golangci-lint</code> tool. In the root of your Go project, run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>golangci-lint run --disable-all --enable staticcheck
</span></span></code></pre></div><p>This command turns off all default linters and enables only the <code>staticcheck</code> linter. You can view the complete list of
run options with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>golangci-lint run --help
</span></span></code></pre></div><p>For our project, we add a few more flags to the <code>golangci-lint run</code> command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>golangci-lint run --disable-all --enable staticcheck --timeout 10m --max-same-issues <span style=color:#ae81ff>0</span> --max-issues-per-linter <span style=color:#ae81ff>0</span> --exclude-dirs ./node_modules
</span></span></code></pre></div><h2 id=analyze-and-fix-staticcheck-issues><a href=#analyze-and-fix-staticcheck-issues class=header-anchor></a>Analyze and fix staticcheck issues</h2><h3 id=sa1019---using-a-deprecated-function-variable-constant-or-field><a href=#sa1019---using-a-deprecated-function-variable-constant-or-field class=header-anchor></a><a class=link href=https://staticcheck.dev/docs/checks#SA1019 target=_blank rel=noopener>SA1019 - Using a deprecated function, variable, constant or field</a></h3><p>After running the linter, the first thing we notice is a considerable number of
<a class=link href=https://staticcheck.dev/docs/checks#SA1019 target=_blank rel=noopener>SA1019</a> fails flagging deprecations, such as:</p><pre tabindex=0><code>cmd/osquery-perf/agent.go:2574:2: SA1019: rand.Seed has been deprecated since Go 1.20 and an alternative has been available since Go 1.0: As of Go 1.20 there is no reason to call Seed with a random value. Programs that call Seed with a known value to get a specific sequence of results should use New(NewSource(seed)) to obtain a local random generator. (staticcheck)
        rand.Seed(*randSeed)
        ^
</code></pre><p>or</p><pre tabindex=0><code>server/service/appconfig.go:970:5: SA1019: customSettings[i].Labels is deprecated: the Labels field is now deprecated, it is superseded by LabelsIncludeAll, so any value set via this field will be transferred to LabelsIncludeAll. (staticcheck)
                                customSettings[i].Labels = nil
                                ^
</code></pre><p>The first fail flags a Go library depreciation issue. Although we could fix it, we are not worried because of Go&rsquo;s
commitment to backward compatibility.</p><p>The second <code>SA1019</code> deprecation fail flags an internal depreciation within our app. However, we must maintain many
deprecated functions within our app for backward compatibility until they can be removed with the next major release.
So, many of these failures cannot be fixed. We could waive each one, but that would be a lot of busy work.</p><p>Enabling <code>SA1019</code> as a default <code>staticcheck</code> rule is a mistake. We suspect many potential users of <code>staticcheck</code> will be
turned off by the sheer number of these fails and will simply turn off <code>staticcheck</code> in their projects.</p><p>We decide to suppress them for now by creating a custom configuration file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>linters-settings</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>staticcheck</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>checks</span>: [<span style=color:#e6db74>&#34;all&#34;</span>, <span style=color:#e6db74>&#34;-ST1000&#34;</span>, <span style=color:#e6db74>&#34;-ST1003&#34;</span>, <span style=color:#e6db74>&#34;-ST1016&#34;</span>, <span style=color:#e6db74>&#34;-ST1020&#34;</span>, <span style=color:#e6db74>&#34;-ST1021&#34;</span>, <span style=color:#e6db74>&#34;-ST1022&#34;</span>, <span style=color:#e6db74>&#34;-SA1019&#34;</span>]
</span></span></code></pre></div><p>We use the <a class=link href=https://staticcheck.dev/docs/configuration/#example-configuration target=_blank rel=noopener>default staticcheck checks</a> and turn off
the <code>SA1019</code> check.</p><p>We then run <code>golangci-lint</code> with the custom configuration file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>golangci-lint run --disable-all --enable staticcheck --config staticcheck.yml
</span></span></code></pre></div><h3 id=sa1032---wrong-order-of-arguments-to-errorsis><a href=#sa1032---wrong-order-of-arguments-to-errorsis class=header-anchor></a><a class=link href=https://staticcheck.dev/docs/checks/#SA1032 target=_blank rel=noopener>SA1032 - Wrong order of arguments to errors.Is</a></h3><p>After rerunning the linter, we saw a <code>SA1032</code> fail:</p><pre tabindex=0><code>server/datastore/mysql/vpp.go:1090:6: SA1032: arguments have the wrong order (staticcheck)
                if errors.Is(sql.ErrNoRows, err) {
                   ^
</code></pre><p>This failure is a good catch and a potential bug. We fix it by swapping the arguments:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>Is</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>sql</span>.<span style=color:#a6e22e>ErrNoRows</span>) {
</span></span></code></pre></div><h3 id=sa4005---field-assignment-that-will-never-be-observed-did-you-mean-to-use-a-pointer-receiver><a href=#sa4005---field-assignment-that-will-never-be-observed-did-you-mean-to-use-a-pointer-receiver class=header-anchor></a><a class=link href=https://staticcheck.dev/docs/checks/#SA4005 target=_blank rel=noopener>SA4005 - Field assignment that will never be observed. Did you mean to use a pointer receiver?</a></h3><p>Another fail we saw was <code>SA4005</code>:</p><pre tabindex=0><code>server/mail/users.go:44:2: SA4005: ineffective assignment to field PasswordResetMailer.CurrentYear (staticcheck)
        r.CurrentYear = time.Now().Year()
        ^
</code></pre><p>The relevant Go code is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>    <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>CurrentYear</span> = <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>Year</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>server</span>.<span style=color:#a6e22e>GetTemplate</span>(<span style=color:#e6db74>&#34;server/mail/templates/password_reset.html&#34;</span>, <span style=color:#e6db74>&#34;email_template&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>msg</span> <span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>Buffer</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>msg</span>, <span style=color:#a6e22e>r</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>In this case, the <code>CurrentYear</code> field was used in our template, but the linter could not detect it. We spent a few
minutes testing the template to ensure that the <code>CurrentYear</code> field was being populated correctly. To waive this
failure, we add a comment:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>    <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>CurrentYear</span> = <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>Year</span>() <span style=color:#75715e>// nolint:staticcheck // SA4005 false positive for Go templates</span>
</span></span></code></pre></div><h3 id=sa4006---a-value-assigned-to-a-variable-is-never-read-before-being-overwritten-forgotten-error-check-or-dead-code><a href=#sa4006---a-value-assigned-to-a-variable-is-never-read-before-being-overwritten-forgotten-error-check-or-dead-code class=header-anchor></a><a class=link href=https://staticcheck.dev/docs/checks/#SA4006 target=_blank rel=noopener>SA4006 - A value assigned to a variable is never read before being overwritten. Forgotten error check or dead code?</a></h3><p>We saw a lot of <code>SA4006</code> fails in our codebase. It was the most common <code>staticcheck</code> fail we encountered. Here is an
example:</p><pre tabindex=0><code>ee/fleetctl/updates_test.go:455:2: SA4006: this value of `repo` is never used (staticcheck)
        repo, err = openRepo(tmpDir)
        ^
</code></pre><p>This is a bug or a potential bug. The developer assigned a value to <code>repo</code> but never used it. We fix it by removing the
assignment:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>openRepo</span>(<span style=color:#a6e22e>tmpDir</span>)
</span></span></code></pre></div><h3 id=sa4009---a-function-argument-is-overwritten-before-its-first-use><a href=#sa4009---a-function-argument-is-overwritten-before-its-first-use class=header-anchor></a><a class=link href=https://staticcheck.dev/docs/checks/#SA4009 target=_blank rel=noopener>SA4009 - A function argument is overwritten before its first use</a></h3><p>Another fail we saw was <code>SA4009</code>. Here is an example:</p><pre tabindex=0><code>orbit/pkg/installer/installer.go:288:37: SA4009: argument ctx is overwritten before first use (staticcheck)
func (r *Runner) runInstallerScript(ctx context.Context, scriptContents string, installerPath string, fileName string) (string, int, error) {
                                    ^
</code></pre><p>This is another bug or potential bug. A function argument is passed in but then immediately overwritten and never used.
This issue could be challenging to fix because it requires specific code knowledge.</p><h3 id=other-fails><a href=#other-fails class=header-anchor></a>Other fails</h3><p>We found a few other fails that were not as critical as the ones mentioned above. We fixed them as we went along. See
the video below for more details.</p><h2 id=overall-impressions><a href=#overall-impressions class=header-anchor></a>Overall impressions</h2><p>Overall, we like the <code>staticcheck</code> linter. It found many bugs or potential bugs and provided a lot of value.</p><p>We did have to ignore the <code>SA1019</code> check and encountered an <code>SA4005</code> false positive.</p><p>We will enable it in our CI/CD pipeline and continue to use it in our project.</p><h2 id=further-reading><a href=#further-reading class=header-anchor></a>Further reading</h2><ul><li>See <a class=link href=../code-complexity-metrics/>how to use linting to improve Go code complexity</a>.</li><li>Recently, we wrote about
<a class=link href=../opentelemetry-with-jaeger/>finding performance issues with OpenTelemetry and Jaeger in your Go project</a>.</li><li>We also wrote about <a class=link href=../optimizing-performance-of-go-app/>optimizing the performance of your Go code</a>.</li><li>We also published an article on <a class=link href=../go-modules-and-packages/>Go modules and packages</a>.</li></ul><h2 id=example-code-on-github><a href=#example-code-on-github class=header-anchor></a>Example code on GitHub</h2><p><a class=link href=https://github.com/fleetdm/fleet/tree/b4a5a1fb49666dd3b10cfd11ccf26190ad9d2902 target=_blank rel=noopener>Fleet repo we used when enabling staticcheck (as of this writing)</a></p><h2 id=watch-us-enable-staticcheck-in-our-go-project><a href=#watch-us-enable-staticcheck-in-our-go-project class=header-anchor></a>Watch us enable staticcheck in our Go project</h2><div class=video-wrapper><iframe loading=lazy src=https://www.youtube.com/embed/oqmVtN-Soig allowfullscreen title="YouTube Video"></iframe></div><p><em>Note:</em> If you want to comment on this article, please do so on the YouTube video.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/devtools/>DevTools</a>
<a href=/tags/golang/>Golang</a>
<a href=/tags/linting/>Linting</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/posts/opentelemetry-with-jaeger/><div class=article-image><img src=/posts/opentelemetry-with-jaeger/opentelemetry-with-jaeger-headline.c3681919fd37f2097d5153e107cbdd8b_hu_77628e87135e054d.png width=250 height=150 loading=lazy alt="Featured image of post Is OpenTelemetry useful for the average software developer?" data-hash="md5-w2gZGf038gl9UVPhB8vdiw=="></div><div class=article-details><h2 class=article-title>Is OpenTelemetry useful for the average software developer?</h2></div></a></article><article class=has-image><a href=/posts/linting-and-formatting-typescript/><div class=article-image><img src=/posts/linting-and-formatting-typescript/linting-and-formatting-headline.f62a1b3a1d22a8e213587610c90c7a84_hu_4c20dd9e05ad2bda.png width=250 height=150 loading=lazy alt="Featured image of post Linting and formatting TypeScript in Chrome extension (2024)" data-hash="md5-9iobOh0iqOITWHYQyQx6hA=="></div><div class=article-details><h2 class=article-title>Linting and formatting TypeScript in Chrome extension (2024)</h2></div></a></article><article class=has-image><a href=/posts/go-json-unmarshal/><div class=article-image><img src=/posts/go-json-unmarshal/go-json-unmarshal-headline.1f80c428c0bfb8b40d6322952093ab97_hu_23f56c6cc21bed49.png width=250 height=150 loading=lazy alt="Featured image of post Use Go to unmarshal JSON null, set, and missing fields" data-hash="md5-H4DEKMC/uLQNYyKVIJOrlw=="></div><div class=article-details><h2 class=article-title>Use Go to unmarshal JSON null, set, and missing fields</h2></div></a></article><article class=has-image><a href=/posts/go-test-execution-time/><div class=article-image><img src=/posts/go-test-execution-time/crash-test-dummy-headline.b52944a60a898bc6ca376849bf1212e9_hu_f927f9af09a65a7b.png width=250 height=150 loading=lazy alt="Featured image of post How to measure the execution time of Go tests accurately" data-hash="md5-tSlEpgqJi8bKN2hJvxIS6Q=="></div><div class=article-details><h2 class=article-title>How to measure the execution time of Go tests accurately</h2></div></a></article><article class=has-image><a href=/posts/optimizing-performance-of-go-app/><div class=article-image><img src=/posts/optimizing-performance-of-go-app/race-cars-headline.183d0aca26b964d790229bf05059e03b_hu_bb248e5de3b20483.png width=250 height=150 loading=lazy alt="Featured image of post How to benchmark performance of Go serializers" data-hash="md5-GD0Kyia5ZNeQIpvwUFngOw=="></div><div class=article-details><h2 class=article-title>How to benchmark performance of Go serializers</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2025 Victor on Software</section><section class=powerby></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>