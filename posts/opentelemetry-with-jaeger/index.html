<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="First impressions of OpenTelemetry with Jaeger and use cases for software developers"><title>Is OpenTelemetry useful for the average software developer?</title><link rel=canonical href=https://victoronsoftware.com/posts/opentelemetry-with-jaeger/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="Is OpenTelemetry useful for the average software developer?"><meta property='og:description' content="First impressions of OpenTelemetry with Jaeger and use cases for software developers"><meta property='og:url' content='https://victoronsoftware.com/posts/opentelemetry-with-jaeger/'><meta property='og:site_name' content='Victor on Software'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:tag' content='Telemetry'><meta property='article:tag' content='Observability'><meta property='article:tag' content='DevTools'><meta property='article:tag' content='Performance'><meta property='article:tag' content='Golang'><meta property='article:published_time' content='2024-10-30T00:00:00+00:00'><meta property='article:modified_time' content='2024-10-30T00:00:00+00:00'><meta property='og:image' content='https://victoronsoftware.com/posts/opentelemetry-with-jaeger/opentelemetry-with-jaeger-headline.png'><meta property='article:author' content='Victor Lyuboslavsky'><meta name=twitter:title content="Is OpenTelemetry useful for the average software developer?"><meta name=twitter:description content="First impressions of OpenTelemetry with Jaeger and use cases for software developers"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://victoronsoftware.com/posts/opentelemetry-with-jaeger/opentelemetry-with-jaeger-headline.png'><script async src="https://www.googletagmanager.com/gtag/js?id=G-1XV381YSQ8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-1XV381YSQ8")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_c8fdb37897842f49.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Victor on Software</a></h1><h2 class=site-description>Software engineering, security, and related topics</h2></div></header><ol class=menu-social><li><a href=https://fleetdm.com target=_blank title=Fleet rel=me><svg width="58.219mm" height="58.202mm" viewBox="0 0 58.219 58.202"><g stroke-width=".26458"><path d="m7.5963 14.823c3.954.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2054-7.1594-7.1594-7.1594-3.954.0-7.1594 3.2053-7.1594 7.1594.0 3.954 3.2053 7.1594 7.1594 7.1594z" fill="#63c740"/><path d="m29.075 14.823c3.9539.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2054-7.1594-7.1594-7.1594-3.9541.0-7.1595 3.2053-7.1595 7.1594.0 3.954 3.2054 7.1594 7.1595 7.1594z" fill="#5cabdf"/><path d="m50.552 14.823c3.9542.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2052-7.1594-7.1594-7.1594-3.9539.0-7.1594 3.2053-7.1594 7.1594.0 3.954 3.2054 7.1594 7.1594 7.1594z" fill="#d66c7b"/><path d="m7.5963 36.301c3.954.0 7.1594-3.2054 7.1594-7.1594.0-3.9541-3.2054-7.1595-7.1594-7.1595-3.954.0-7.1594 3.2054-7.1594 7.1595.0 3.9539 3.2053 7.1594 7.1594 7.1594z" fill="#c98def"/><path d="m29.075 36.301c3.9539.0 7.1594-3.2054 7.1594-7.1594.0-3.9541-3.2054-7.1595-7.1594-7.1595-3.9541.0-7.1595 3.2054-7.1595 7.1595.0 3.9539 3.2054 7.1594 7.1595 7.1594z" fill="#faa669"/><path d="m7.5963 57.779c3.954.0 7.1594-3.2052 7.1594-7.1594.0-3.9539-3.2054-7.1594-7.1594-7.1594-3.954.0-7.1594 3.2054-7.1594 7.1594.0 3.9542 3.2053 7.1594 7.1594 7.1594z" fill="#3aefc4"/></g></svg></a></li><li><a href=https://github.com/getvictor target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/lyuboslavsky/ target=_blank title=LinkedIn rel=me><svg width="16" height="16" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16"><path d="M0 1.146C0 .513.526.0 1.175.0h13.65C15.474.0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487.0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401m-1.2-8.212c.837.0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822.0-1.359.54-1.359 1.248.0.694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869.0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274.0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54.0 01.016-.025V6.169h-2.4c.03.678.0 7.225.0 7.225h2.4"/></svg></a></li><li><a href=http://www.youtube.com/@VictorOnSoftware target=_blank title=YouTube rel=me><svg height="800" width="800" id="Layer_1" viewBox="0 0 461.001 461.001"><g><path style="fill:#f61c0d" d="M365.257 67.393H95.744C42.866 67.393.0 110.259.0 163.137v134.728c0 52.878 42.866 95.744 95.744 95.744h269.513c52.878.0 95.744-42.866 95.744-95.744V163.137c0-52.878-42.866-95.744-95.744-95.744zM300.506 237.056l-126.06 60.123c-3.359 1.602-7.239-.847-7.239-4.568V168.607c0-3.774 3.982-6.22 7.348-4.514l126.06 63.881C304.363 229.873 304.298 235.248 300.506 237.056z"/></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/page/speaking/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 2m0 3a3 3 0 013-3h0a3 3 0 013 3v5a3 3 0 01-3 3h0a3 3 0 01-3-3z"/><path d="M5 10a7 7 0 0014 0"/><path d="M8 21h8"/><path d="M12 17v4"/></svg>
<span>Speaking</span></a></li><li><a href=/page/tools/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Software tools</span></a></li><li><a href=/page/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/page/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/opentelemetry-with-jaeger/><img src=/posts/opentelemetry-with-jaeger/opentelemetry-with-jaeger-headline_hu_b539408f365bb1ec.png srcset="/posts/opentelemetry-with-jaeger/opentelemetry-with-jaeger-headline_hu_b539408f365bb1ec.png 800w, /posts/opentelemetry-with-jaeger/opentelemetry-with-jaeger-headline_hu_1229bb21e34db73c.png 1600w" width=800 height=419 loading=lazy alt="Featured image of post Is OpenTelemetry useful for the average software developer?"></a></div><div class=article-details><header class=article-category><a href=/categories/software-development/>Software Development
</a><a href=/categories/devops--infrastructure/>DevOps & Infrastructure</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/posts/opentelemetry-with-jaeger/>Is OpenTelemetry useful for the average software developer?</a></h2><h3 class=article-subtitle>First impressions of OpenTelemetry with Jaeger and use cases for software developers</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Oct 30, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><p>This article discusses our first impressions of using OpenTelemetry with Jaeger.</p><ul><li><a class=link href=#use-cases-for-opentelemetry-and-jaeger>Use cases for OpenTelemetry and Jaeger</a></li><li><a class=link href=#problems-with-opentelemetry-and-jaeger>Problems with OpenTelemetry and Jaeger</a></li></ul><h2 id=what-is-opentelemetry><a href=#what-is-opentelemetry class=header-anchor></a>What is OpenTelemetry?</h2><p><a class=link href=https://opentelemetry.io/ target=_blank rel=noopener>OpenTelemetry</a> is a set of APIs, libraries, agents, and instrumentation for collecting
distributed traces and metrics from your applications. It provides a standardized way to instrument your code and
collect telemetry data. OpenTelemetry supports programming languages like Java, Python, Go, JavaScript, etc.</p><p>Tracing is a method of monitoring and profiling your application to understand how requests flow through your system.
For example, you can view the associated database calls and requests to other services for a single API request. Tracing
allows you to identify bottlenecks, latency issues, and other performance problems.</p><h2 id=what-is-jaeger><a href=#what-is-jaeger class=header-anchor></a>What is Jaeger?</h2><p><a class=link href=https://www.jaegertracing.io/ target=_blank rel=noopener>Jaeger</a> is an open-source, end-to-end distributed tracing system. Jaeger is popular for
tracing applications because of its scalability, ease of use, and integration with other tools. Jaeger provides a
web-based UI for viewing traces and analyzing performance data.</p><h2 id=add-opentelemetry-instrumentation-to-your-application><a href=#add-opentelemetry-instrumentation-to-your-application class=header-anchor></a>Add OpenTelemetry instrumentation to your application</h2><p>To start with OpenTelemetry and Jaeger, you must instrument your application with OpenTelemetry libraries.</p><p>In our case, we used the OpenTelemetry Go SDK to instrument our Go application. We added the necessary dependencies to
our project.</p><pre tabindex=0><code>go get go.opentelemetry.io/otel@v1.31.0
go get go.opentelemetry.io/otel/exporters/otlp/otlptrace@v1.31.0
go get go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc@v1.31.0
go get go.opentelemetry.io/otel/sdk@v1.31.0
go get go.opentelemetry.io/contrib/instrumentation/github.com/gorilla/mux/otelmux@v0.56.0
go get github.com/XSAM/otelsql@v0.35.0
</code></pre><p>The <code>go.opentelemetry.io/contrib/instrumentation/github.com/gorilla/mux/otelmux</code> package is needed to instrument our
<code>gorilla/mux</code> HTTP router.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>    <span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>mux</span>.<span style=color:#a6e22e>NewRouter</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Use</span>(<span style=color:#a6e22e>otelmux</span>.<span style=color:#a6e22e>Middleware</span>(<span style=color:#e6db74>&#34;fleet&#34;</span>))
</span></span></code></pre></div><p>The <code>github.com/XSAM/otelsql</code> package is needed to instrument our SQL database queries.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;github.com/XSAM/otelsql&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#a6e22e>semconv</span> <span style=color:#e6db74>&#34;go.opentelemetry.io/otel/semconv/v1.26.0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>otelTracedDriverName</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>init</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>otelTracedDriverName</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>otelsql</span>.<span style=color:#a6e22e>Register</span>(<span style=color:#e6db74>&#34;mysql&#34;</span>,
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>otelsql</span>.<span style=color:#a6e22e>WithAttributes</span>(<span style=color:#a6e22e>semconv</span>.<span style=color:#a6e22e>DBSystemMySQL</span>),
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>otelsql</span>.<span style=color:#a6e22e>WithSpanOptions</span>(<span style=color:#a6e22e>otelsql</span>.<span style=color:#a6e22e>SpanOptions</span>{
</span></span><span style=display:flex><span>          <span style=color:#75715e>// DisableErrSkip ignores driver.ErrSkip errors, which are frequently returned by the MySQL</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e>// driver when certain optional methods or paths are not implemented/taken.</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e>// For example, interpolateParams=false (the secure default) will not do a parametrized</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e>// sql.conn.query directly without preparing it first, causing driver.ErrSkip</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>DisableErrSkip</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>          <span style=color:#75715e>// Omitting span for sql.conn.reset_session since it takes ~1us and doesn&#39;t provide useful</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e>// information</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>OmitConnResetSession</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>          <span style=color:#75715e>// Omitting span for sql.rows since it is very quick and typically doesn&#39;t provide useful</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e>// information beyond what&#39;s already reported by prepare/exec/query</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>OmitRows</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>       }),
</span></span><span style=display:flex><span>       <span style=color:#75715e>// WithSpanNameFormatter allows us to customize the span name, which is especially useful for SQL</span>
</span></span><span style=display:flex><span>       <span style=color:#75715e>// queries run outside an HTTPS transaction, which do not belong to a parent span, show up as their</span>
</span></span><span style=display:flex><span>       <span style=color:#75715e>// own trace, and would otherwise be named &#34;sql.conn.query&#34; or &#34;sql.conn.exec&#34;.</span>
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>otelsql</span>.<span style=color:#a6e22e>WithSpanNameFormatter</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>method</span> <span style=color:#a6e22e>otelsql</span>.<span style=color:#a6e22e>Method</span>, <span style=color:#a6e22e>query</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>query</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>             <span style=color:#66d9ef>return</span> string(<span style=color:#a6e22e>method</span>)
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>          <span style=color:#75715e>// Append query with extra whitespaces removed</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>query</span> = <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Fields</span>(<span style=color:#a6e22e>query</span>), <span style=color:#e6db74>&#34; &#34;</span>)
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>query</span>) &gt; <span style=color:#ae81ff>100</span> {
</span></span><span style=display:flex><span>             <span style=color:#a6e22e>query</span> = <span style=color:#a6e22e>query</span>[:<span style=color:#ae81ff>100</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;...&#34;</span>
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>return</span> string(<span style=color:#a6e22e>method</span>) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>query</span>
</span></span><span style=display:flex><span>       }),
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>       panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then, use <code>otelTracedDriverName</code> to open a connection to your database.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>    <span style=color:#a6e22e>db</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>sql</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#a6e22e>otelTracedDriverName</span>, <span style=color:#e6db74>&#34;user:password@tcp(localhost:3306)/database&#34;</span>)
</span></span></code></pre></div><p>When starting your application, you must create an OpenTelemetry exporter and a trace provider.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>    <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>client</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>otlptracegrpc</span>.<span style=color:#a6e22e>NewClient</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>otlpTraceExporter</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>otlptrace</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>client</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        panic(<span style=color:#e6db74>&#34;Failed to initialize tracing&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>batchSpanProcessor</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>trace</span>.<span style=color:#a6e22e>NewBatchSpanProcessor</span>(<span style=color:#a6e22e>otlpTraceExporter</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tracerProvider</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>trace</span>.<span style=color:#a6e22e>NewTracerProvider</span>(<span style=color:#a6e22e>trace</span>.<span style=color:#a6e22e>WithSpanProcessor</span>(<span style=color:#a6e22e>batchSpanProcessor</span>))
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>otel</span>.<span style=color:#a6e22e>SetTracerProvider</span>(<span style=color:#a6e22e>tracerProvider</span>)
</span></span></code></pre></div><h2 id=launch-jaeger><a href=#launch-jaeger class=header-anchor></a>Launch Jaeger</h2><p>To view traces, you need to launch Jaeger. You can run Jaeger locally using Docker. Based on the
<a class=link href=https://www.jaegertracing.io/docs/1.62/getting-started/ target=_blank rel=noopener>Jaeger 1.62 Getting Started guide</a>, you can run the following
command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --rm --name jaeger <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -p 16686:16686 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -p 4317:4317 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>jaegertracing/all-in-one:1.62.0
</span></span></code></pre></div><p>In our example, we are only exposing two ports:</p><ul><li><code>4317</code> for the Jaeger collector, which receives trace data using OpenTelemetry Protocol (OTLP) over gRPC</li><li><code>16686</code> for the Jaeger UI</li></ul><h2 id=launch-your-application><a href=#launch-your-application class=header-anchor></a>Launch your application</h2><p>Before starting your application, you must set the OpenTelemetry endpoint to send traces to Jaeger. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export OTEL_SERVICE_NAME<span style=color:#f92672>=</span>fleet
</span></span><span style=display:flex><span>export OTEL_EXPORTER_OTLP_ENDPOINT<span style=color:#f92672>=</span>http://localhost:4317
</span></span></code></pre></div><p>Now, you can start your application.</p><h2 id=view-traces-in-jaeger><a href=#view-traces-in-jaeger class=header-anchor></a>View traces in Jaeger</h2><p>Open your browser and navigate to <a class=link href=http://localhost:16686 target=_blank rel=noopener>http://localhost:16686</a> to view traces in the Jaeger UI.
Select your <strong>Service</strong> name and click <strong>Find Traces</strong>.</p><p>You can click into a trace to view the details of each span. You can see the duration, logs, and tags for each span. The
example below shows the HTTP request details and multiple SQL queries.</p><figure><img src=/posts/opentelemetry-with-jaeger/example-jaeger-trace.png alt="Fleet hosts request with SQL queries to sessions, users, user_teams, and host tables."></figure><h2 id=use-cases-for-opentelemetry-and-jaeger><a href=#use-cases-for-opentelemetry-and-jaeger class=header-anchor></a>Use cases for OpenTelemetry and Jaeger</h2><p>In a local software development environment, OpenTelemetry and Jaeger can be used to:</p><ul><li>Fix bottlenecks and latency issues</li><li>Understand how requests flow through your system</li></ul><p>If a bottleneck is known or suspected, Jaeger can help you identify the root cause. For example, you can see which
database queries are taking the most time and optimize them.</p><p>When developing new features, Jaeger can help you understand how requests flow through your system. This telemetry data
provides a quick check to ensure your new feature works as expected.</p><p>In a production environment, OpenTelemetry and Jaeger can be used to:</p><ul><li>Monitor and profile your applications</li><li>Troubleshoot performance issues</li><li>Optimize your applications and improve user experience</li><li>Ensure your applications meet service level objectives (SLOs)</li></ul><h2 id=problems-with-opentelemetry-and-jaeger><a href=#problems-with-opentelemetry-and-jaeger class=header-anchor></a>Problems with OpenTelemetry and Jaeger</h2><p>OpenTelemetry and Jaeger are powerful tools, yet their development use seems limited to fixing performance bottlenecks.
They cannot be used for general debugging out of the box since they don&rsquo;t provide enough detail for each specific
request, such as the request body.</p><p>In addition, missing spans can be a problem. If your application is not instrumented correctly, you may not see all the
spans you expect or know about in Jaeger. Our application lacks spans for some API endpoints, Redis transactions,
outbound HTTP requests, and asynchronous processes. Adding all of these spans requires additional development and QA
efforts.</p><p>The Jaeger UI itself is basic and lacks some features. For example, regex search is missing out of the box, unless
Elasticsearch/OpenSearch storage is added.</p><p>Our chosen SQL instrumentation library, <a class=link href=https://github.com/XSAM/otelsql target=_blank rel=noopener>github.com/XSAM/otelsql</a>, could be better. It
does not provide a way to trace the transaction lifecycle, and it creates many spans at the root level, clogging the
Jaeger UI.</p><h2 id=further-reading><a href=#further-reading class=header-anchor></a>Further reading</h2><ul><li><p><strong><a class=link href=../opentelemetry-for-devs/>OpenTelemetry: A developer&rsquo;s best friend for production-ready code</a></strong><br>How we changed our minds about OpenTelemetry and now advocate for developers to use it during development.</p></li><li><p><strong><a class=link href=../software-load-testing/>Top 5 metrics for software load testing performance</a></strong><br>Essential metrics to track when evaluating your application&rsquo;s performance under load.</p></li><li><p><strong><a class=link href=../optimizing-performance-of-go-app/>How to benchmark performance of Go serializers</a></strong><br>Learn effective techniques for measuring and optimizing Go code performance.</p></li></ul><h2 id=example-code-on-github><a href=#example-code-on-github class=header-anchor></a>Example code on GitHub</h2><p><a class=link href=https://github.com/fleetdm/fleet/tree/6bc0b5dcd9214c6e3ff94fe657947aeccbdad352 target=_blank rel=noopener>Fleet Device Management repo with OpenTelemetry instrumentation (as of this writing)</a></p><h2 id=watch-opentelemetry-with-jaeger-video><a href=#watch-opentelemetry-with-jaeger-video class=header-anchor></a>Watch OpenTelemetry with Jaeger video</h2><div class=video-wrapper><iframe loading=lazy src=https://www.youtube.com/embed/eQhdvU2gsmQ allowfullscreen title="YouTube Video"></iframe></div><p><em>Note:</em> If you want to comment on this article, please do so on the YouTube video.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/telemetry/>Telemetry</a>
<a href=/tags/observability/>Observability</a>
<a href=/tags/devtools/>DevTools</a>
<a href=/tags/performance/>Performance</a>
<a href=/tags/golang/>Golang</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/posts/optimizing-performance-of-go-app/><div class=article-image><img src=/posts/optimizing-performance-of-go-app/race-cars-headline.183d0aca26b964d790229bf05059e03b_hu_bb248e5de3b20483.png width=250 height=150 loading=lazy alt="Featured image of post How to benchmark performance of Go serializers" data-hash="md5-GD0Kyia5ZNeQIpvwUFngOw=="></div><div class=article-details><h2 class=article-title>How to benchmark performance of Go serializers</h2></div></a></article><article class=has-image><a href=/posts/go-json-unmarshal/><div class=article-image><img src=/posts/go-json-unmarshal/go-json-unmarshal-headline.1f80c428c0bfb8b40d6322952093ab97_hu_23f56c6cc21bed49.png width=250 height=150 loading=lazy alt="Featured image of post Use Go to unmarshal JSON null, set, and missing fields" data-hash="md5-H4DEKMC/uLQNYyKVIJOrlw=="></div><div class=article-details><h2 class=article-title>Use Go to unmarshal JSON null, set, and missing fields</h2></div></a></article><article class=has-image><a href=/posts/go-test-execution-time/><div class=article-image><img src=/posts/go-test-execution-time/crash-test-dummy-headline.b52944a60a898bc6ca376849bf1212e9_hu_f927f9af09a65a7b.png width=250 height=150 loading=lazy alt="Featured image of post How to measure the execution time of Go tests accurately" data-hash="md5-tSlEpgqJi8bKN2hJvxIS6Q=="></div><div class=article-details><h2 class=article-title>How to measure the execution time of Go tests accurately</h2></div></a></article><article class=has-image><a href=/posts/get-args-from-stdin/><div class=article-image><img src=/posts/get-args-from-stdin/stdin-headline.cf73246657a79bf645a99e743dca1f1f_hu_a0992f8c0384a420.png width=250 height=150 loading=lazy alt="Featured image of post Why you should use STDIN to read your program arguments" data-hash="md5-z3MkZlenm/ZFqZ50PcofHw=="></div><div class=article-details><h2 class=article-title>Why you should use STDIN to read your program arguments</h2></div></a></article><article class=has-image><a href=/posts/linting-and-formatting-typescript/><div class=article-image><img src=/posts/linting-and-formatting-typescript/linting-and-formatting-headline.f62a1b3a1d22a8e213587610c90c7a84_hu_4c20dd9e05ad2bda.png width=250 height=150 loading=lazy alt="Featured image of post Linting and formatting TypeScript in Chrome extension (2024)" data-hash="md5-9iobOh0iqOITWHYQyQx6hA=="></div><div class=article-details><h2 class=article-title>Linting and formatting TypeScript in Chrome extension (2024)</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2025 Victor on Software</section><section class=powerby></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>