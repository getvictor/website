<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Learn how to benchmark the performance of your Go code to make informed decisions"><title>How to benchmark performance of Go serializers</title><link rel=canonical href=https://victoronsoftware.com/posts/optimizing-performance-of-go-app/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="How to benchmark performance of Go serializers"><meta property='og:description' content="Learn how to benchmark the performance of your Go code to make informed decisions"><meta property='og:url' content='https://victoronsoftware.com/posts/optimizing-performance-of-go-app/'><meta property='og:site_name' content='Victor on Software'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:tag' content='Golang'><meta property='article:tag' content='Performance'><meta property='article:tag' content='JSON'><meta property='article:published_time' content='2024-08-28T00:00:00+00:00'><meta property='article:modified_time' content='2024-08-28T00:00:00+00:00'><meta property='og:image' content='https://victoronsoftware.com/posts/optimizing-performance-of-go-app/race-cars-headline.png'><meta property='article:author' content='Victor Lyuboslavsky'><meta name=twitter:title content="How to benchmark performance of Go serializers"><meta name=twitter:description content="Learn how to benchmark the performance of your Go code to make informed decisions"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://victoronsoftware.com/posts/optimizing-performance-of-go-app/race-cars-headline.png'><script async src="https://www.googletagmanager.com/gtag/js?id=G-1XV381YSQ8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-1XV381YSQ8")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_c8fdb37897842f49.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Victor on Software</a></h1><h2 class=site-description>Software engineering, security, and related topics</h2></div></header><ol class=menu-social><li><a href=https://fleetdm.com target=_blank title=Fleet rel=me><svg width="58.219mm" height="58.202mm" viewBox="0 0 58.219 58.202"><g stroke-width=".26458"><path d="m7.5963 14.823c3.954.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2054-7.1594-7.1594-7.1594-3.954.0-7.1594 3.2053-7.1594 7.1594.0 3.954 3.2053 7.1594 7.1594 7.1594z" fill="#63c740"/><path d="m29.075 14.823c3.9539.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2054-7.1594-7.1594-7.1594-3.9541.0-7.1595 3.2053-7.1595 7.1594.0 3.954 3.2054 7.1594 7.1595 7.1594z" fill="#5cabdf"/><path d="m50.552 14.823c3.9542.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2052-7.1594-7.1594-7.1594-3.9539.0-7.1594 3.2053-7.1594 7.1594.0 3.954 3.2054 7.1594 7.1594 7.1594z" fill="#d66c7b"/><path d="m7.5963 36.301c3.954.0 7.1594-3.2054 7.1594-7.1594.0-3.9541-3.2054-7.1595-7.1594-7.1595-3.954.0-7.1594 3.2054-7.1594 7.1595.0 3.9539 3.2053 7.1594 7.1594 7.1594z" fill="#c98def"/><path d="m29.075 36.301c3.9539.0 7.1594-3.2054 7.1594-7.1594.0-3.9541-3.2054-7.1595-7.1594-7.1595-3.9541.0-7.1595 3.2054-7.1595 7.1595.0 3.9539 3.2054 7.1594 7.1595 7.1594z" fill="#faa669"/><path d="m7.5963 57.779c3.954.0 7.1594-3.2052 7.1594-7.1594.0-3.9539-3.2054-7.1594-7.1594-7.1594-3.954.0-7.1594 3.2054-7.1594 7.1594.0 3.9542 3.2053 7.1594 7.1594 7.1594z" fill="#3aefc4"/></g></svg></a></li><li><a href=https://github.com/getvictor target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/lyuboslavsky/ target=_blank title=LinkedIn rel=me><svg width="16" height="16" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16"><path d="M0 1.146C0 .513.526.0 1.175.0h13.65C15.474.0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487.0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401m-1.2-8.212c.837.0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822.0-1.359.54-1.359 1.248.0.694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869.0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274.0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54.0 01.016-.025V6.169h-2.4c.03.678.0 7.225.0 7.225h2.4"/></svg></a></li><li><a href=http://www.youtube.com/@VictorOnSoftware target=_blank title=YouTube rel=me><svg height="800" width="800" id="Layer_1" viewBox="0 0 461.001 461.001"><g><path style="fill:#f61c0d" d="M365.257 67.393H95.744C42.866 67.393.0 110.259.0 163.137v134.728c0 52.878 42.866 95.744 95.744 95.744h269.513c52.878.0 95.744-42.866 95.744-95.744V163.137c0-52.878-42.866-95.744-95.744-95.744zM300.506 237.056l-126.06 60.123c-3.359 1.602-7.239-.847-7.239-4.568V168.607c0-3.774 3.982-6.22 7.348-4.514l126.06 63.881C304.363 229.873 304.298 235.248 300.506 237.056z"/></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/page/speaking/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 2m0 3a3 3 0 013-3h0a3 3 0 013 3v5a3 3 0 01-3 3h0a3 3 0 01-3-3z"/><path d="M5 10a7 7 0 0014 0"/><path d="M8 21h8"/><path d="M12 17v4"/></svg>
<span>Speaking</span></a></li><li><a href=/page/tools/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Software tools</span></a></li><li><a href=/page/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/page/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/optimizing-performance-of-go-app/><img src=/posts/optimizing-performance-of-go-app/race-cars-headline_hu_28794f4e3ce83c06.png srcset="/posts/optimizing-performance-of-go-app/race-cars-headline_hu_28794f4e3ce83c06.png 800w, /posts/optimizing-performance-of-go-app/race-cars-headline_hu_ffec90530b79da55.png 1600w" width=800 height=419 loading=lazy alt="Featured image of post How to benchmark performance of Go serializers"></a></div><div class=article-details><header class=article-category><a href=/categories/software-development/>Software Development</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/posts/optimizing-performance-of-go-app/>How to benchmark performance of Go serializers</a></h2><h3 class=article-subtitle>Learn how to benchmark the performance of your Go code to make informed decisions</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Aug 28, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>4 minute read</time></div></footer></div></header><section class=article-content><ul><li><a class=link href=#creating-go-benchmark>Creating a Go benchmark</a></li><li><a class=link href=#running-go-benchmarks>Running Go benchmarks</a></li></ul><h2 id=what-is-benchmarking><a href=#what-is-benchmarking class=header-anchor></a>What is benchmarking?</h2><p>Performance optimization is a critical part of software development. Once your application has been released and is
being used by real users, you may need to optimize its performance. One way to do this is to benchmark your code to
identify bottlenecks and improve its performance. Benchmarking provides you with data to make informed decisions about
what parts of your code can be sped up and by how much.</p><p>Benchmarking is the process of measuring your code&rsquo;s performance. It involves running your code multiple times and
measuring how long it takes to execute. By running your code multiple times, you can get an average execution time,
which is more reliable than a one-off report.</p><h2 id=identifying-the-bottlenecks><a href=#identifying-the-bottlenecks class=header-anchor></a>Identifying the bottlenecks</h2><p>In our application, we deserialize and process large amounts of JSON data once every hour. We noticed that this process
was taking a long time for some of our users. First, we used
<a class=link href=https://github.com/google/pprof/blob/main/doc/README.md target=_blank rel=noopener>Go pprof</a> to enable profiling and generated a flame graph to
identify the bottlenecks in our code.</p><figure><img src=/posts/optimizing-performance-of-go-app/go-pprof-flame-graph.png alt="Flame graph showing the execution time of different parts of the Go app"><figcaption><h4>Go pprof flame graph</h4></figcaption></figure><p>The flame graph showed us that the JSON decoding process took the most time. We benchmarked different serialization
libraries to find the fastest one for our use case.</p><h2 id=creating-go-benchmark><a href=#creating-go-benchmark class=header-anchor></a>Creating a Go benchmark</h2><p>In Go, you can write benchmarks using the built-in testing package. Benchmarks are written similarly to unit tests but
with the <strong>Benchmark</strong> prefix instead of the <strong>Test</strong> prefix.</p><p>Before creating and running the benchmark, we generated 1000 test JSON files in the <code>testdata</code> directory.</p><p>To benchmark JSON decoding, we created the following benchmark.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>files</span> = <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>itemsPerFile</span> = <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>BenchmarkJSONImport</span>(<span style=color:#a6e22e>b</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>B</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>N</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       <span style=color:#75715e>// Read in the file (do not time)</span>
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>StopTimer</span>()
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>fileNumber</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>%</span> <span style=color:#a6e22e>files</span>
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>ReadFile</span>(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;testdata/sample_%d.json&#34;</span>, <span style=color:#a6e22e>fileNumber</span>))
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>       }
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>StartTimer</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>samples</span> []<span style=color:#a6e22e>Sample</span>
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>dec</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>NewDecoder</span>(<span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>NewReader</span>(<span style=color:#a6e22e>data</span>))
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>dec</span>.<span style=color:#a6e22e>Decode</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>samples</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>       }
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>samples</span>) <span style=color:#f92672>!=</span> <span style=color:#a6e22e>itemsPerFile</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>Fatalf</span>(<span style=color:#e6db74>&#34;expected %d samples, got %d&#34;</span>, <span style=color:#a6e22e>itemsPerFile</span>, len(<span style=color:#a6e22e>samples</span>))
</span></span><span style=display:flex><span>       }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Starting the function name with <code>Benchmark</code> indicates to <code>go test</code> that this is a benchmark.</p><p>The testing package adjusts the number of iterations through the <code>for i := 0; i &lt; b.N; i++</code> loop until the function
lasts long enough to be timed reliably.</p><p>The <code>b.StopTimer()</code> and <code>b.StartTimer()</code> calls exclude part of the code from the benchmark.</p><h2 id=running-go-benchmarks><a href=#running-go-benchmarks class=header-anchor></a>Running Go benchmarks</h2><p>To run all benchmarks, add <code>-bench=.</code> flag to <code>go test</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go test -bench<span style=color:#f92672>=</span>.
</span></span></code></pre></div><p>The result will look like this:</p><pre tabindex=0><code>goos: darwin
goarch: arm64
pkg: serializer
cpu: Apple M2 Pro
BenchmarkJSONImport-12           357      3324997 ns/op
PASS
ok      serializer 1.868s
</code></pre><p>It tells us that unmarshalling a single file with <code>json.Decode</code> takes an average of 3.3 milliseconds. The benchmark ran
the loop 357 times.</p><h2 id=benchmarking-encodinggob><a href=#benchmarking-encodinggob class=header-anchor></a>Benchmarking encoding/gob</h2><p>Next, we will benchmark the built-in <a class=link href=https://pkg.go.dev/encoding/gob target=_blank rel=noopener>encoding/gob</a> library.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>BenchmarkGobImport</span>(<span style=color:#a6e22e>b</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>B</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>N</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       <span style=color:#75715e>// Read in the file (do not time)</span>
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>StopTimer</span>()
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>fileNumber</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>%</span> <span style=color:#a6e22e>files</span>
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>ReadFile</span>(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;testdata/sample_%d.bin&#34;</span>, <span style=color:#a6e22e>fileNumber</span>))
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>       }
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>StartTimer</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       <span style=color:#75715e>// decode gob</span>
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>samples</span> []<span style=color:#a6e22e>Sample</span>
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>dec</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gob</span>.<span style=color:#a6e22e>NewDecoder</span>(<span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>NewReader</span>(<span style=color:#a6e22e>data</span>))
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>dec</span>.<span style=color:#a6e22e>Decode</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>samples</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>       }
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>samples</span>) <span style=color:#f92672>!=</span> <span style=color:#a6e22e>itemsPerFile</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>Fatalf</span>(<span style=color:#e6db74>&#34;expected %d samples, got %d&#34;</span>, <span style=color:#a6e22e>itemsPerFile</span>, len(<span style=color:#a6e22e>samples</span>))
</span></span><span style=display:flex><span>       }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Running the two benchmarks gives us:</p><pre tabindex=0><code>BenchmarkJSONImport-12           360      3279579 ns/op
BenchmarkGobImport-12           2262       475469 ns/op
</code></pre><p>The benchmark data shows that decoding with <code>encoding/gob</code> takes almost 7 times faster than using <code>encoding/json</code>. This
gives sufficient data to present to our management and argue for switching from JSON. In addition, we can benchmark
other serialization libraries to see if any of them are even faster.</p><p>For additional data, we included reading the file in our benchmark numbers for a complete picture of the expected
speedup:</p><pre tabindex=0><code>BenchmarkJSONImport-12               360      3374064 ns/op
BenchmarkGobImport-12               2710       481935 ns/op
BenchmarkJSONImportFile-12           306      3746758 ns/op
BenchmarkGobImportFile-12           2176       554254 ns/op
</code></pre><h2 id=go-benchmark-code-on-github><a href=#go-benchmark-code-on-github class=header-anchor></a>Go benchmark code on GitHub</h2><p>The complete code is available on GitHub at: <a class=link href=https://github.com/getvictor/go-benchmark-serializers target=_blank rel=noopener>https://github.com/getvictor/go-benchmark-serializers</a></p><h2 id=further-reading><a href=#further-reading class=header-anchor></a>Further reading</h2><ul><li><p><strong><a class=link href=../opentelemetry-for-devs/>OpenTelemetry for developers: From skeptic to advocate</a></strong><br>Learn how using OpenTelemetry during development leads to better production instrumentation.</p></li><li><p><strong><a class=link href=../opentelemetry-with-jaeger/>Is OpenTelemetry useful for the average software developer?</a></strong><br>Explore the practical benefits and limitations of OpenTelemetry with Jaeger for development.</p></li><li><p><strong><a class=link href=../software-load-testing/>Top 5 metrics for software load testing performance</a></strong><br>Discover the critical metrics to monitor when load testing your applications.</p></li><li><p><strong><a class=link href=../go-test-execution-time/>Accurately measuring Go test execution time</a></strong><br>Master techniques for precise test timing measurements in Go projects.</p></li><li><p><strong><a class=link href=../go-json-unmarshal/>Go JSON unmarshaling with null, set, and missing fields</a></strong><br>Handle complex JSON payloads effectively in your Go applications.</p></li><li><p><strong><a class=link href=../fuzz-testing-with-go/>Creating fuzz tests in Go</a></strong><br>Strengthen your code with automated fuzz testing techniques.</p></li></ul><h2 id=watch-how-to-benchmark-go-serializers><a href=#watch-how-to-benchmark-go-serializers class=header-anchor></a>Watch how to benchmark Go serializers</h2><div class=video-wrapper><iframe loading=lazy src=https://www.youtube.com/embed/c0drQ2JUYmo allowfullscreen title="YouTube Video"></iframe></div><p><em>Note:</em> If you want to comment on this article, please do so on the YouTube video.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/golang/>Golang</a>
<a href=/tags/performance/>Performance</a>
<a href=/tags/json/>JSON</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/posts/get-args-from-stdin/><div class=article-image><img src=/posts/get-args-from-stdin/stdin-headline.cf73246657a79bf645a99e743dca1f1f_hu_a0992f8c0384a420.png width=250 height=150 loading=lazy alt="Featured image of post Why you should use STDIN to read your program arguments" data-hash="md5-z3MkZlenm/ZFqZ50PcofHw=="></div><div class=article-details><h2 class=article-title>Why you should use STDIN to read your program arguments</h2></div></a></article><article class=has-image><a href=/posts/mtls-go-client-windows-certificate-store/><div class=article-image><img src=/posts/mtls-go-client-windows-certificate-store/mtls-go-windows.0a8dfbc39a48ef72269453d3110b2806_hu_d51a96f4f46d4237.png width=250 height=150 loading=lazy alt="Featured image of post Mutual TLS (mTLS) Go client using Windows certificate store" data-hash="md5-Co37w5pI73ImlFPTEQsoBg=="></div><div class=article-details><h2 class=article-title>Mutual TLS (mTLS) Go client using Windows certificate store</h2></div></a></article><article class=has-image><a href=/posts/mtls-go-client-using-apple-keychain/><div class=article-image><img src=/posts/mtls-go-client-using-apple-keychain/mtls-go-apple-keychain.4be855897ea7b8897e027a30c449d256_hu_9ed786d2df619267.png width=250 height=150 loading=lazy alt="Featured image of post Mutual TLS (mTLS) Go client using macOS keychain" data-hash="md5-S+hViX6nuIl+AnowxEnSVg=="></div><div class=article-details><h2 class=article-title>Mutual TLS (mTLS) Go client using macOS keychain</h2></div></a></article><article class=has-image><a href=/posts/mtls-go-custom-signer/><div class=article-image><img src=/posts/mtls-go-custom-signer/signer.4d60e63c2cfbb31978535b2b67059f38_hu_af326207bb1743e7.png width=250 height=150 loading=lazy alt="Featured image of post Mutual TLS (mTLS) Go client with custom certificate signer" data-hash="md5-TWDmPCz7sxl4U1srZwWfOA=="></div><div class=article-details><h2 class=article-title>Mutual TLS (mTLS) Go client with custom certificate signer</h2></div></a></article><article class=has-image><a href=/posts/mtls-go-client/><div class=article-image><img src=/posts/mtls-go-client/go-client.d367a206fbe9c06685ee92f65e0026b9_hu_d3473fd8194625a0.png width=250 height=150 loading=lazy alt="Featured image of post Mutual TLS (mTLS) Go client" data-hash="md5-02eiBvvpwGaF7pL2XgAmuQ=="></div><div class=article-details><h2 class=article-title>Mutual TLS (mTLS) Go client</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2025 Victor on Software</section><section class=powerby></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>