<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="3 ways to verify the functionality of your Windows NDES SCEP server after setting it up"><title>How to test a Windows NDES SCEP server</title><link rel=canonical href=https://victoronsoftware.com/posts/test-ndes-scep-server/><link rel=stylesheet href=/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css><meta property='og:title' content="How to test a Windows NDES SCEP server"><meta property='og:description' content="3 ways to verify the functionality of your Windows NDES SCEP server after setting it up"><meta property='og:url' content='https://victoronsoftware.com/posts/test-ndes-scep-server/'><meta property='og:site_name' content='Victor on Software'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:tag' content='Windows'><meta property='article:tag' content='SCEP'><meta property='article:tag' content='Certificates'><meta property='article:tag' content='MDM'><meta property='article:published_time' content='2024-10-02T00:00:00+00:00'><meta property='article:modified_time' content='2024-10-02T00:00:00+00:00'><meta property='og:image' content='https://victoronsoftware.com/posts/test-ndes-scep-server/windows-security-headline.png'><meta property='article:author' content='Victor Lyuboslavsky'><meta name=twitter:title content="How to test a Windows NDES SCEP server"><meta name=twitter:description content="3 ways to verify the functionality of your Windows NDES SCEP server after setting it up"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://victoronsoftware.com/posts/test-ndes-scep-server/windows-security-headline.png'><script async src="https://www.googletagmanager.com/gtag/js?id=G-1XV381YSQ8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-1XV381YSQ8")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_c8fdb37897842f49.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Victor on Software</a></h1><h2 class=site-description>Software engineering, security, and related topics</h2></div></header><ol class=menu-social><li><a href=https://fleetdm.com target=_blank title=Fleet rel=me><svg width="58.219mm" height="58.202mm" viewBox="0 0 58.219 58.202"><g stroke-width=".26458"><path d="m7.5963 14.823c3.954.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2054-7.1594-7.1594-7.1594-3.954.0-7.1594 3.2053-7.1594 7.1594.0 3.954 3.2053 7.1594 7.1594 7.1594z" fill="#63c740"/><path d="m29.075 14.823c3.9539.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2054-7.1594-7.1594-7.1594-3.9541.0-7.1595 3.2053-7.1595 7.1594.0 3.954 3.2054 7.1594 7.1595 7.1594z" fill="#5cabdf"/><path d="m50.552 14.823c3.9542.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2052-7.1594-7.1594-7.1594-3.9539.0-7.1594 3.2053-7.1594 7.1594.0 3.954 3.2054 7.1594 7.1594 7.1594z" fill="#d66c7b"/><path d="m7.5963 36.301c3.954.0 7.1594-3.2054 7.1594-7.1594.0-3.9541-3.2054-7.1595-7.1594-7.1595-3.954.0-7.1594 3.2054-7.1594 7.1595.0 3.9539 3.2053 7.1594 7.1594 7.1594z" fill="#c98def"/><path d="m29.075 36.301c3.9539.0 7.1594-3.2054 7.1594-7.1594.0-3.9541-3.2054-7.1595-7.1594-7.1595-3.9541.0-7.1595 3.2054-7.1595 7.1595.0 3.9539 3.2054 7.1594 7.1595 7.1594z" fill="#faa669"/><path d="m7.5963 57.779c3.954.0 7.1594-3.2052 7.1594-7.1594.0-3.9539-3.2054-7.1594-7.1594-7.1594-3.954.0-7.1594 3.2054-7.1594 7.1594.0 3.9542 3.2053 7.1594 7.1594 7.1594z" fill="#3aefc4"/></g></svg></a></li><li><a href=https://github.com/getvictor target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/lyuboslavsky/ target=_blank title=LinkedIn rel=me><svg width="16" height="16" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16"><path d="M0 1.146C0 .513.526.0 1.175.0h13.65C15.474.0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487.0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401m-1.2-8.212c.837.0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822.0-1.359.54-1.359 1.248.0.694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869.0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274.0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54.0 01.016-.025V6.169h-2.4c.03.678.0 7.225.0 7.225h2.4"/></svg></a></li><li><a href=http://www.youtube.com/@VictorOnSoftware target=_blank title=YouTube rel=me><svg height="800" width="800" id="Layer_1" viewBox="0 0 461.001 461.001"><g><path style="fill:#f61c0d" d="M365.257 67.393H95.744C42.866 67.393.0 110.259.0 163.137v134.728c0 52.878 42.866 95.744 95.744 95.744h269.513c52.878.0 95.744-42.866 95.744-95.744V163.137c0-52.878-42.866-95.744-95.744-95.744zM300.506 237.056l-126.06 60.123c-3.359 1.602-7.239-.847-7.239-4.568V168.607c0-3.774 3.982-6.22 7.348-4.514l126.06 63.881C304.363 229.873 304.298 235.248 300.506 237.056z"/></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/page/speaking/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 2m0 3a3 3 0 013-3h0a3 3 0 013 3v5a3 3 0 01-3 3h0a3 3 0 01-3-3z"/><path d="M5 10a7 7 0 0014 0"/><path d="M8 21h8"/><path d="M12 17v4"/></svg>
<span>Speaking</span></a></li><li><a href=/page/tools/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Software tools</span></a></li><li><a href=/page/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/page/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/test-ndes-scep-server/><img src=/posts/test-ndes-scep-server/windows-security-headline_hu_de2b672fd2611ab8.png srcset="/posts/test-ndes-scep-server/windows-security-headline_hu_de2b672fd2611ab8.png 800w, /posts/test-ndes-scep-server/windows-security-headline_hu_ac6a84806f59130d.png 1600w" width=800 height=419 loading=lazy alt="Featured image of post How to test a Windows NDES SCEP server"></a></div><div class=article-details><header class=article-category><a href=/categories/devops--infrastructure/>DevOps & Infrastructure</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/posts/test-ndes-scep-server/>How to test a Windows NDES SCEP server</a></h2><h3 class=article-subtitle>3 ways to verify the functionality of your Windows NDES SCEP server after setting it up</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Oct 02, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><ul><li><a class=link href=#test-ndes-using-powershell>Test NDES using PowerShell</a></li><li><a class=link href=#test-ndes-using-a-scep-client>Test NDES using a SCEP client</a></li><li><a class=link href=#test-ndes-using-apple-mdm-profile>Test NDES using Apple MDM profile</a></li></ul><h1 id=what-is-a-windows-ndes-scep-server><a href=#what-is-a-windows-ndes-scep-server class=header-anchor></a>What is a Windows NDES SCEP server?</h1><p><a class=link href=https://datatracker.ietf.org/doc/html/rfc8894 target=_blank rel=noopener>SCEP</a> (Simple Certificate Enrollment Protocol) is a protocol used to
issue certificates with a Certificate Authority (CA) in a Public Key Infrastructure (PKI). It allows devices to request
and receive certificates over a secure channel without user interaction. IT admins use SCEP for network devices, mobile
devices, and other endpoints that need to authenticate themselves. The issued certificates can be used for various
purposes, such as Wi-Fi authentication, VPN access, email encryption, etc. For example, a new mobile device can request
a certificate from the SCEP server to authenticate on the corporate Wi-Fi network.</p><p>NDES (Network Device Enrollment Service) is a Microsoft implementation of the SCEP protocol. NDES is part of the Active
Directory Certificate Services (AD CS) role in Windows Server.</p><h1 id=setting-up-a-windows-ndes-scep-server><a href=#setting-up-a-windows-ndes-scep-server class=header-anchor></a>Setting up a Windows NDES SCEP server</h1><p>Before testing your Windows NDES SCEP server, you must set it up. Numerous articles and guides cover the installation
and configuration of NDES. This article will focus on testing the NDES SCEP server to ensure the correct setup. We wrote
this article because we could not find a comprehensive guide on how to test the NDES SCEP server.</p><p>Here are the high-level steps to configure a Windows NDES SCEP server:</p><ol><li>Create or use an existing Windows AD (Active Directory) server and domain.</li><li>Install the Active Directory Certificate Services (AD CS) role on a Windows Server that is part of the AD domain.</li><li>Configure the Enterprise NDES role service within AD CS.</li><li>(Optional) Configure the certificate templates for NDES.</li></ol><p>We used Windows Server 2022 for our tests, and we will update this article once we test with Windows Server 2025.</p><h1 id=test-ndes-using-a-web-browser><a href=#test-ndes-using-a-web-browser class=header-anchor></a>Test NDES using a web browser</h1><p>First, we must make sure the NDES server is accessible via a web browser. If the server should be accessible outside the
corporate network, test it using the public URL or IP address.</p><p>The NDES server has an admin web interface for retrieving the SCEP challenge. The URL typically looks like
<code>http://ndes-server/certsrv/mscep_admin/</code> and requires authentication. The username must use the Windows name format,
like <code>username@example.domain.com</code>. Accessing this URL should prompt you to log in and display the SCEP challenge.</p><figure><img src=/posts/test-ndes-scep-server/ndes-mscep_admin.png alt="Network Device Enrollment Service allows you to obtain certificates for routers or other network devices using the Simple Certificate Enrollment Protocol (SCEP). To complete certificate enrollment for your network device you will need the following information: The thumbprint (hash value) for the CA certificate is: A656FA66 AB12B433 A2DA5CF7 CC153D9A The enrollment challenge password is: 1ED0DD50F7459D6E This password can be used only once and will expire within 60 minutes. Each enrollment requires a new challenge password. You can refresh this web page to obtain a new challenge password. For more information see Using Network Device Enrollment Service."></figure><p><strong>Note:</strong> The above admin page is encoded as UTF-16, as opposed to the more popular UTF-8 encoding. This encoding must
considered when parsing this page with a script.</p><p>The other URL to test is the actual SCEP enrollment URL, typically <code>http://ndes-server/certsrv/mscep/mscep.dll</code>. It
returns the following.</p><figure><img src=/posts/test-ndes-scep-server/ndes-mscep.png alt="Network Device Enrollment Service allows you to obtain certificates for routers or other network devices using the Simple Certificate Enrollment Protocol (SCEP). This URL is used by network devices to submit certificate requests. To obtain an enrollment challenge password, go to the admin URL. By default, the admin URL is http://ndes-server/CertSrv/mscep_admin For more information see Using Network Device Enrollment Service."></figure><h1 id=test-ndes-using-powershell><a href=#test-ndes-using-powershell class=header-anchor></a>Test NDES using PowerShell</h1><p>For our first test, we will use PowerShell to request a certificate from another Windows machine in the same AD domain.</p><p>Below is a sample PowerShell script that requests a certificate from the NDES server. Update the URL and the challenge
password.</p><script type=application/javascript src=https://gist.github.com/getvictor/fd2e7b88603be7898087b0f445102daf.js></script><p>After running the script, check that NDES issued a certificate.</p><h1 id=test-ndes-using-a-scep-client><a href=#test-ndes-using-a-scep-client class=header-anchor></a>Test NDES using a SCEP client</h1><p>For our next test, we will use an SCEP client to request a certificate from the NDES server. Several SCEP clients are
available, but many have been abandoned and do not work with NDES.</p><p>We will use <a class=link href=https://github.com/micromdm/scep target=_blank rel=noopener>micromdm/scep</a>, a Go-based open-source SCEP server and client. We will
use the latest code from the <code>main</code> branch, with the following commit hash: <code>781f8042a79cabcf61a5e6c01affdbadcb785932</code>.</p><p>Follow the instructions from the above URL to install the <code>scep</code> client. We built it for macOS M1 using the following
command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make scepclient-darwin-arm64
</span></span></code></pre></div><p>After building the client, obtain a new enrollment challenge password and run the following command to request a
certificate from the NDES server:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir test
</span></span><span style=display:flex><span>cd test
</span></span><span style=display:flex><span>../scepclient-darwin-arm64 -key-encipherment-selector -cn <span style=color:#e6db74>&#34;ScepClient&#34;</span> -challenge <span style=color:#e6db74>&#34;ABBFE34CF11C2C04&#34;</span> -server-url <span style=color:#e6db74>&#34;https://my-ndes.com/certsrv/mscep/mscep.dll&#34;</span> -debug -private-key ./ndes-pk
</span></span></code></pre></div><p><strong>Note:</strong> We recommend running the above command in a separate directory because the SCEP client generates several
intermediate files during the certificate request process. If you don&rsquo;t clean them up, the client may reuse them instead
of generating new ones from the command line flags.</p><p>The above command will generate a new certificate request and send it to the NDES server. The server will respond with a
signed certificate, which the client will save to the current directory as a <code>client.pem</code> file.</p><p>As a final step, verify that the certificate and the private key match by building a PKCS#12 file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>/usr/bin/openssl pkcs12 -export -inkey ndes-pk -in client.pem -out client.p12
</span></span></code></pre></div><h1 id=test-ndes-using-apple-mdm-profile><a href=#test-ndes-using-apple-mdm-profile class=header-anchor></a>Test NDES using Apple MDM profile</h1><p>For our final test, we will use an Apple MDM profile to request a certificate from the NDES server. We will use a macOS
VM enrolled in Fleet Device Management&rsquo;s MDM server. However, adding the MDM profile manually via <strong>System Settings</strong> ->
<strong>Profiles</strong> should also work.</p><p>First, create a new
<a class=link href="https://developer.apple.com/documentation/devicemanagement/scep?language=objc" target=_blank rel=noopener>Device Management SCEP payload</a> with the
NDES server&rsquo;s URL and the challenge password. Then, assign the SCEP payload to your device. Here&rsquo;s an example payload:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE plist PUBLIC &#34;-//Apple//DTD PLIST 1.0//EN&#34; &#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd&#34;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;plist</span> <span style=color:#a6e22e>version=</span><span style=color:#e6db74>&#34;1.0&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;dict&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;key&gt;</span>PayloadContent<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;array&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;dict&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;key&gt;</span>PayloadContent<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;dict&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;key&gt;</span>Challenge<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;string&gt;</span>8E6D19CAEC9411CC<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;key&gt;</span>Key Type<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;string&gt;</span>RSA<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;key&gt;</span>Key Usage<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;integer&gt;</span>5<span style=color:#f92672>&lt;/integer&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;key&gt;</span>Keysize<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;integer&gt;</span>2048<span style=color:#f92672>&lt;/integer&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;key&gt;</span>Retries<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;integer&gt;</span>3<span style=color:#f92672>&lt;/integer&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;key&gt;</span>RetryDelay<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;integer&gt;</span>10<span style=color:#f92672>&lt;/integer&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;key&gt;</span>Subject<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;array&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;array&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;array&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;string&gt;</span>CN<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;string&gt;</span>MDM TEST VM<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;/array&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/array&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;array&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;array&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;string&gt;</span>OU<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;string&gt;</span>FLEET DEVICE MANAGEMENT<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;/array&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/array&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;/array&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;key&gt;</span>URL<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;string&gt;</span>https://my-ndes.com/certsrv/mscep/mscep.dll<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/dict&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;key&gt;</span>PayloadDisplayName<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;string&gt;</span>SCEP #1<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;key&gt;</span>PayloadIdentifier<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;string&gt;</span>com.apple.security.scep.9DCC35A5-72F9-42B7-9A98-7AD9A9CCA3AA<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;key&gt;</span>PayloadType<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;string&gt;</span>com.apple.security.scep<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;key&gt;</span>PayloadUUID<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;string&gt;</span>9DCC35A5-72F9-42B7-9A98-7AD9A9CCA3AA<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;key&gt;</span>PayloadVersion<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;integer&gt;</span>1<span style=color:#f92672>&lt;/integer&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/dict&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/array&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;key&gt;</span>PayloadDisplayName<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;string&gt;</span>SCEP cert<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;key&gt;</span>PayloadIdentifier<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;string&gt;</span>Victors-Fleet-MBP.4CD1BD65-1D2C-4E9E-9E18-9BCD400CDEDB<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;key&gt;</span>PayloadType<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;string&gt;</span>Configuration<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;key&gt;</span>PayloadUUID<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;string&gt;</span>4CD1BD65-1D2C-4E9E-9E18-9BCD400CDEDB<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;key&gt;</span>PayloadVersion<span style=color:#f92672>&lt;/key&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;integer&gt;</span>1<span style=color:#f92672>&lt;/integer&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/dict&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/plist&gt;</span>
</span></span></code></pre></div><p>Once the device receives the payload, it immediately requests a certificate from the NDES server. The server responds
with a signed certificate, which the device saves to the keychain.</p><h1 id=further-reading><a href=#further-reading class=header-anchor></a>Further reading</h1><p>Recently, we covered <a class=link href=../connect-to-remote-active-directory/>how to connect to a remote Active Directory server</a>.</p><p>We also wrote a series of articles on
<a class=link href=../mtls/>building a mutual TLS client which uses a system keystore, such as a Windows certificate store</a>.</p><p>In addition, we presented an example of <a class=link href=../code-signing-windows/>code signing a Windows application</a>.</p><h1 id=watch-how-to-test-a-windows-ndes-scep-server><a href=#watch-how-to-test-a-windows-ndes-scep-server class=header-anchor></a>Watch how to test a Windows NDES SCEP server</h1><div class=video-wrapper><iframe loading=lazy src=https://www.youtube.com/embed/JMHs6spfdvQ allowfullscreen title="YouTube Video"></iframe></div><p><em>Note:</em> If you want to comment on this article, please do so on the YouTube video.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/windows/>Windows</a>
<a href=/tags/scep/>SCEP</a>
<a href=/tags/certificates/>Certificates</a>
<a href=/tags/mdm/>MDM</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/posts/exe-installer/><div class=article-image><img src=/posts/exe-installer/exe-installer-headline.236ff14b850f292633b9cd90798c6b48_hu_99772d264b124c7b.png width=250 height=150 loading=lazy alt="Featured image of post How to create an EXE installer for your program" data-hash="md5-I2/xS4UPKSYzuc2QeYxrSA=="></div><div class=article-details><h2 class=article-title>How to create an EXE installer for your program</h2></div></a></article><article class=has-image><a href=/posts/webhook-flow-with-tines/><div class=article-image><img src=/posts/webhook-flow-with-tines/tines-fleet-webhook-workflow.5f367243ee3250d812a03800fa8bf70c_hu_ee1761eba013e20a.png width=250 height=150 loading=lazy alt="Featured image of post Building a webhook flow with Tines" data-hash="md5-XzZyQ+4yUNgSoDgA+ov3DA=="></div><div class=article-details><h2 class=article-title>Building a webhook flow with Tines</h2></div></a></article><article class=has-image><a href=/posts/code-signing-windows/><div class=article-image><img src=/posts/code-signing-windows/digital-signature-ok.ef8d50e314c4b5431265517eb98f3ed4_hu_387738396b7dc022.png width=250 height=150 loading=lazy alt="Featured image of post Code signing a Windows application" data-hash="md5-741Q4xTEtUMSZVF+uY8+1A=="></div><div class=article-details><h2 class=article-title>Code signing a Windows application</h2></div></a></article><article class=has-image><a href=/posts/mtls-go-client-windows-certificate-store/><div class=article-image><img src=/posts/mtls-go-client-windows-certificate-store/mtls-go-windows.0a8dfbc39a48ef72269453d3110b2806_hu_d51a96f4f46d4237.png width=250 height=150 loading=lazy alt="Featured image of post Mutual TLS (mTLS) Go client using Windows certificate store" data-hash="md5-Co37w5pI73ImlFPTEQsoBg=="></div><div class=article-details><h2 class=article-title>Mutual TLS (mTLS) Go client using Windows certificate store</h2></div></a></article><article class=has-image><a href=/posts/mtls-with-windows/><div class=article-image><img src=/posts/mtls-with-windows/mtls-edge.148b2d13beb1a2231542bf5950875c93_hu_3f398bc0370fa618.png width=250 height=150 loading=lazy alt="Featured image of post Mutual TLS (mTLS) with Windows certificate store" data-hash="md5-FIstE76xoiMVQr9ZUIdckw=="></div><div class=article-details><h2 class=article-title>Mutual TLS (mTLS) with Windows certificate store</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2025 Victor on Software</section><section class=powerby></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>