<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Improve developer experience by optimizing Go test execution time using detailed performance data"><title>How to measure the execution time of Go tests accurately</title>
<link rel=canonical href=https://victoronsoftware.com/posts/go-test-execution-time/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="How to measure the execution time of Go tests accurately"><meta property='og:description' content="Improve developer experience by optimizing Go test execution time using detailed performance data"><meta property='og:url' content='https://victoronsoftware.com/posts/go-test-execution-time/'><meta property='og:site_name' content='Victor on Software'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:tag' content='Golang'><meta property='article:tag' content='Unit Testing'><meta property='article:tag' content='Developer Experience'><meta property='article:published_time' content='2024-09-04T00:00:00+00:00'><meta property='article:modified_time' content='2024-09-04T00:00:00+00:00'><meta property='og:image' content='https://victoronsoftware.com/posts/go-test-execution-time/crash-test-dummy-headline.png'><meta property='article:author' content='Victor Lyuboslavsky'><meta name=twitter:title content="How to measure the execution time of Go tests accurately"><meta name=twitter:description content="Improve developer experience by optimizing Go test execution time using detailed performance data"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://victoronsoftware.com/posts/go-test-execution-time/crash-test-dummy-headline.png'><script async src="https://www.googletagmanager.com/gtag/js?id=G-1XV381YSQ8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-1XV381YSQ8")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu7557696702933755770.png width=300 height=297 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Victor on Software</a></h1><h2 class=site-description>Software engineering, security, and related topics</h2></div></header><ol class=menu-social><li><a href=https://fleetdm.com target=_blank title=Fleet rel=me><svg width="58.219mm" height="58.202mm" viewBox="0 0 58.219 58.202"><g stroke-width=".26458"><path d="m7.5963 14.823c3.954.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2054-7.1594-7.1594-7.1594-3.954.0-7.1594 3.2053-7.1594 7.1594.0 3.954 3.2053 7.1594 7.1594 7.1594z" fill="#63c740"/><path d="m29.075 14.823c3.9539.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2054-7.1594-7.1594-7.1594-3.9541.0-7.1595 3.2053-7.1595 7.1594.0 3.954 3.2054 7.1594 7.1595 7.1594z" fill="#5cabdf"/><path d="m50.552 14.823c3.9542.0 7.1594-3.2053 7.1594-7.1594.0-3.954-3.2052-7.1594-7.1594-7.1594-3.9539.0-7.1594 3.2053-7.1594 7.1594.0 3.954 3.2054 7.1594 7.1594 7.1594z" fill="#d66c7b"/><path d="m7.5963 36.301c3.954.0 7.1594-3.2054 7.1594-7.1594.0-3.9541-3.2054-7.1595-7.1594-7.1595-3.954.0-7.1594 3.2054-7.1594 7.1595.0 3.9539 3.2053 7.1594 7.1594 7.1594z" fill="#c98def"/><path d="m29.075 36.301c3.9539.0 7.1594-3.2054 7.1594-7.1594.0-3.9541-3.2054-7.1595-7.1594-7.1595-3.9541.0-7.1595 3.2054-7.1595 7.1595.0 3.9539 3.2054 7.1594 7.1595 7.1594z" fill="#faa669"/><path d="m7.5963 57.779c3.954.0 7.1594-3.2052 7.1594-7.1594.0-3.9539-3.2054-7.1594-7.1594-7.1594-3.954.0-7.1594 3.2054-7.1594 7.1594.0 3.9542 3.2053 7.1594 7.1594 7.1594z" fill="#3aefc4"/></g></svg></a></li><li><a href=https://github.com/getvictor target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/lyuboslavsky/ target=_blank title=LinkedIn rel=me><svg width="16" height="16" fill="currentcolor" class="bi bi-linkedin" viewBox="0 0 16 16"><path d="M0 1.146C0 .513.526.0 1.175.0h13.65C15.474.0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487.0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401m-1.2-8.212c.837.0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822.0-1.359.54-1.359 1.248.0.694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869.0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274.0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54.0 01.016-.025V6.169h-2.4c.03.678.0 7.225.0 7.225h2.4"/></svg></a></li><li><a href=http://www.youtube.com/@VictorOnSoftware target=_blank title=YouTube rel=me><svg height="800" width="800" id="Layer_1" viewBox="0 0 461.001 461.001"><g><path style="fill:#f61c0d" d="M365.257 67.393H95.744C42.866 67.393.0 110.259.0 163.137v134.728c0 52.878 42.866 95.744 95.744 95.744h269.513c52.878.0 95.744-42.866 95.744-95.744V163.137c0-52.878-42.866-95.744-95.744-95.744zM300.506 237.056l-126.06 60.123c-3.359 1.602-7.239-.847-7.239-4.568V168.607c0-3.774 3.982-6.22 7.348-4.514l126.06 63.881C304.363 229.873 304.298 235.248 300.506 237.056z"/></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/page/tools/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Software tools</span></a></li><li><a href=/page/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/page/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/go-test-execution-time/><img src=/posts/go-test-execution-time/crash-test-dummy-headline_hu94287030865306436.png srcset="/posts/go-test-execution-time/crash-test-dummy-headline_hu94287030865306436.png 800w, /posts/go-test-execution-time/crash-test-dummy-headline_hu10247083307173493574.png 1600w" width=800 height=419 loading=lazy alt="Featured image of post How to measure the execution time of Go tests accurately"></a></div><div class=article-details><header class=article-category><a href=/categories/software-development/>Software Development</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/posts/go-test-execution-time/>How to measure the execution time of Go tests accurately</a></h2><h3 class=article-subtitle>Improve developer experience by optimizing Go test execution time using detailed performance data</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Sep 04, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>6 minute read</time></div></footer></div></header><section class=article-content><ul><li><a class=link href=#accurately-measuring-test-execution-time>Accurately measuring test execution time</a></li></ul><h2 id=why-measure-test-execution-time><a href=#why-measure-test-execution-time class=header-anchor></a>Why measure test execution time?</h2><p>By speeding up your test suite, you&rsquo;re improving developer experience and productivity. Faster tests mean faster
feedback, which leads to quicker iterations and better code quality.</p><p>When you run tests, you want to know how long they take to execute. This information can help you optimize your test
suite and make it run faster. By measuring the execution time of your tests, you can identify slow tests and improve
their performance.</p><h2 id=problems-with-current-measurement-tools><a href=#problems-with-current-measurement-tools class=header-anchor></a>Problems with current measurement tools</h2><p>We have yet to find a tool that provides detailed, actionable insights into the performance of Go tests.</p><p>For example, running the <code>gotestsum tool slowest</code> command from the
<a class=link href=https://github.com/gotestyourself/gotestsum target=_blank rel=noopener>gotestsum</a> tool gave us the following output for our test suite:</p><pre tabindex=0><code>github.com/fleetdm/fleet/v4/server/datastore/mysql TestMDMApple 6m9.65s
github.com/fleetdm/fleet/v4/server/datastore/mysql TestSoftware 4m8.9s
github.com/fleetdm/fleet/v4/server/datastore/mysql TestPolicies 3m31s
github.com/fleetdm/fleet/v4/server/datastore/mysql TestActivity 2m16.67s
github.com/fleetdm/fleet/v4/server/datastore/mysql TestMDMWindows 2m14.85s
github.com/fleetdm/fleet/v4/server/datastore/mysql TestMDMShared 2m10.27s
github.com/fleetdm/fleet/v4/server/datastore/mysql TestVulnerabilities 2m7.98s
github.com/fleetdm/fleet/v4/server/datastore/mysql TestPacks 1m59.2s
github.com/fleetdm/fleet/v4/server/worker TestAppleMDM 1m55.11s
github.com/fleetdm/fleet/v4/server/datastore/mysql TestTeams 1m47.82s
github.com/fleetdm/fleet/v4/server/datastore/mysql TestAppConfig 1m42.81s
github.com/fleetdm/fleet/v4/server/datastore/mysql TestHosts 1m41.79s
github.com/fleetdm/fleet/v4/server/datastore/mysql/migrations/tables TestUp_20240709183940 1m36.43s
github.com/fleetdm/fleet/v4/server/datastore/mysql/migrations/tables TestUp_20240709132642 1m36.34s
github.com/fleetdm/fleet/v4/server/datastore/mysql/migrations/tables TestUp_20240725182118 1m35.95s
github.com/fleetdm/fleet/v4/server/datastore/mysql/migrations/tables TestUp_20240730171504 1m35.73s
github.com/fleetdm/fleet/v4/server/vulnerabilities/nvd TestTranslateCPEToCVE/recent_vulns 1m34.87s
...
</code></pre><p>The first thing to notice is that the numbers don&rsquo;t add up. Our test suite takes around 14 minutes to run, but the times
in the report add up to more than 14 minutes. This discrepancy makes it hard to identify the slowest tests.</p><p>The second thing to notice is that our tests contain many subtests. The <code>TestMDMApple</code> test contains over 40 subtests.
We want to know the execution time of each subtest, not just the total time for the test.</p><p>The third thing to notice is that the output does not provide any information regarding parallelism. We want to know if
our tests run in parallel and how many run concurrently. We want to run tests in parallel when possible to speed up the
test suite.</p><h2 id=understanding-parallelism-in-go-tests><a href=#understanding-parallelism-in-go-tests class=header-anchor></a>Understanding parallelism in Go tests</h2><p>Before measuring the execution time of our tests, we need to understand how Go tests run in parallel.</p><figure><img src=/posts/go-test-execution-time/go-test-parallelism.svg alt="Sequence diagram of a go test run with two packages, two tests, and two subtests."></figure><p>When you run <code>go test</code>, Go compiles each package in your test suite in a separate binary. It then runs each binary in
parallel. The tests in different packages run concurrently. This behavior is controlled by the <code>-p</code> flag, which defaults
to <code>GOMAXPROCS</code>, the number of CPUs on your machine.</p><p>Within a package, tests run sequentially by default &ndash; the tests in the same package run one after the other. However,
you can run tests in parallel within a package by calling <code>t.Parallel()</code> in your test functions. This behavior is
controlled by the <code>-parallel</code> flag, which also defaults to <code>GOMAXPROCS</code>. So, in a system with 8 CPUs, running a test
suite with many packages and parallel tests will run 8 packages concurrently and 8 tests within each package
concurrently, for a total of 64 tests running concurrently.</p><p>Each test function may have multiple subtests, which may have their own subtests, and so on. Subtests run sequentially
by default. However, you can also run subtests in parallel by calling <code>t.Parallel()</code> in your subtest functions.</p><h2 id=accurately-measuring-test-execution-time><a href=#accurately-measuring-test-execution-time class=header-anchor></a>Accurately measuring test execution time</h2><p>To measure the execution time of your tests, we must use the <code>-json</code> flag with the <code>go test</code> command. This flag outputs
test results in JSON format, which we can parse and analyze.</p><p>The <code>Action</code> field in the JSON output shows the start and end times of each test and subtest.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Time&#34;</span>: <span style=color:#e6db74>&#34;2024-08-26T19:22:51.969606869Z&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;run&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Package&#34;</span>: <span style=color:#e6db74>&#34;github.com/fleetdm/fleet/v4/cmd/cpe&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Test&#34;</span>: <span style=color:#e6db74>&#34;TestCPEDB&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Time&#34;</span>: <span style=color:#e6db74>&#34;2024-08-26T19:22:51.96984165Z&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;run&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Package&#34;</span>: <span style=color:#e6db74>&#34;github.com/fleetdm/fleet/v4/cmd/cpe&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Test&#34;</span>: <span style=color:#e6db74>&#34;TestCPEDB/test1&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Time&#34;</span>: <span style=color:#e6db74>&#34;2024-08-26T19:22:51.969928132Z&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;pause&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Package&#34;</span>: <span style=color:#e6db74>&#34;github.com/fleetdm/fleet/v4/cmd/cpe&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Test&#34;</span>: <span style=color:#e6db74>&#34;TestCPEDB/test1&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Time&#34;</span>: <span style=color:#e6db74>&#34;2024-08-26T19:22:51.969983777Z&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;run&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Package&#34;</span>: <span style=color:#e6db74>&#34;github.com/fleetdm/fleet/v4/cmd/cpe&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Test&#34;</span>: <span style=color:#e6db74>&#34;TestCPEDB/test2&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Time&#34;</span>: <span style=color:#e6db74>&#34;2024-08-26T19:22:51.970052987Z&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;pause&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Package&#34;</span>: <span style=color:#e6db74>&#34;github.com/fleetdm/fleet/v4/cmd/cpe&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Test&#34;</span>: <span style=color:#e6db74>&#34;TestCPEDB/test2&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Time&#34;</span>: <span style=color:#e6db74>&#34;2024-08-26T19:22:51.970090377Z&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;cont&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Package&#34;</span>: <span style=color:#e6db74>&#34;github.com/fleetdm/fleet/v4/cmd/cpe&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Test&#34;</span>: <span style=color:#e6db74>&#34;TestCPEDB/test1&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Time&#34;</span>: <span style=color:#e6db74>&#34;2024-08-26T19:22:51.973464469Z&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;cont&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Package&#34;</span>: <span style=color:#e6db74>&#34;github.com/fleetdm/fleet/v4/cmd/cpe&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Test&#34;</span>: <span style=color:#e6db74>&#34;TestCPEDB/test2&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Time&#34;</span>: <span style=color:#e6db74>&#34;2024-08-26T19:22:52.015505184Z&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;pass&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Package&#34;</span>: <span style=color:#e6db74>&#34;github.com/fleetdm/fleet/v4/cmd/cpe&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Test&#34;</span>: <span style=color:#e6db74>&#34;TestCPEDB/test1&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Elapsed&#34;</span>: <span style=color:#ae81ff>0.04</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Time&#34;</span>: <span style=color:#e6db74>&#34;2024-08-26T19:22:52.015523238Z&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;pass&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Package&#34;</span>: <span style=color:#e6db74>&#34;github.com/fleetdm/fleet/v4/cmd/cpe&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Test&#34;</span>: <span style=color:#e6db74>&#34;TestCPEDB/test2&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Elapsed&#34;</span>: <span style=color:#ae81ff>0.04</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Time&#34;</span>: <span style=color:#e6db74>&#34;2024-08-26T19:22:52.015527907Z&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;pass&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Package&#34;</span>: <span style=color:#e6db74>&#34;github.com/fleetdm/fleet/v4/cmd/cpe&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Test&#34;</span>: <span style=color:#e6db74>&#34;TestCPEDB&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Elapsed&#34;</span>: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>While parsing the JSON output, we can track how many tests are running in parallel. We can then adjust the execution
time of each test by dividing the total time by the number of tests running concurrently. Since we don&rsquo;t have access to
the actual CPU time each test used, this is the best approximation we can get.</p><p>When tests run in parallel, we typically see the <code>pause</code> and <code>cont</code> actions. If we see these actions, we know that the
test or subtest is running in parallel.</p><p>We created a parser called <a class=link href=https://github.com/getvictor/goteststats target=_blank rel=noopener>goteststats</a> that does these calculations.</p><h2 id=accurate-test-execution-time-measurement-in-practice><a href=#accurate-test-execution-time-measurement-in-practice class=header-anchor></a>Accurate test execution time measurement in practice</h2><p>By running our <a class=link href=https://github.com/getvictor/goteststats target=_blank rel=noopener>goteststats</a> parser on the JSON output of our test suite, we
gained actionable insights into our tests&rsquo; performance.</p><pre tabindex=0><code>WARNING: Stopped test not found in running tests: TestGenerateMDMApple/successful_run
github.com/fleetdm/fleet/v4/server/datastore/mysql/migrations/tables TestUp_20240709132642: 8.142s (total: 2m12.806s parallel: 16)
github.com/fleetdm/fleet/v4/server/cron TestCalendarEvents1KHosts: 7.853s (total: 36.158s parallel: 4)
github.com/fleetdm/fleet/v4/server/cron TestEventForDifferentHost: 7.853s (total: 36.158s parallel: 4)
github.com/fleetdm/fleet/v4/cmd/fleet TestCronVulnerabilitiesCreatesDatabasesPath: 6.878s (total: 30.232s parallel: 4)
github.com/fleetdm/fleet/v4/server/vulnerabilities/nvd TestTranslateCPEToCVE/find_vulns_on_cpes: 6.849s (total: 1m34.89s parallel: 13)
github.com/fleetdm/fleet/v4/server/vulnerabilities/nvd TestTranslateCPEToCVE/recent_vulns: 6.849s (total: 1m34.89s parallel: 13)
github.com/fleetdm/fleet/v4/server/vulnerabilities/oval TestOvalAnalyzer/#load/invalid_vuln_path: 5.844s (total: 1m25.152s parallel: 14)
github.com/fleetdm/fleet/v4/server/vulnerabilities/oval TestOvalAnalyzer/analyzing_RHEL_software: 5.844s (total: 1m25.152s parallel: 14)
github.com/fleetdm/fleet/v4/server/vulnerabilities/oval TestOvalAnalyzer/analyzing_Ubuntu_software: 5.844s (total: 1m25.151s parallel: 14)
github.com/fleetdm/fleet/v4/cmd/fleet TestAutomationsSchedule: 5.699s (total: 14.213s parallel: 2)
github.com/fleetdm/fleet/v4/server/datastore/mysql/migrations/tables TestUp_20240725182118: 5.623s (total: 1m37.577s parallel: 17)
github.com/fleetdm/fleet/v4/server/datastore/mysql/migrations/tables TestUp_20240709183940: 5.588s (total: 1m36.771s parallel: 17)
github.com/fleetdm/fleet/v4/server/datastore/mysql/migrations/tables TestUp_20240709124958: 5.52s (total: 1m35.622s parallel: 17)
github.com/fleetdm/fleet/v4/server/datastore/mysql/migrations/tables TestUp_20240730171504: 5.517s (total: 1m35.74s parallel: 17)
github.com/fleetdm/fleet/v4/server/datastore/mysql/migrations/tables TestUp_20240726100517: 5.418s (total: 1m33.987s parallel: 17)
...
</code></pre><p>For a given test, we provide the adjusted time, the total time, and the average number of tests running concurrently
with this test. The adjusted time is the time the test took to execute, which is also the time saved if we removed this
test from the suite.</p><p>The first thing to notice is that the numbers add up. The total time for the test suite is around 14 minutes, and the
times in the report add up to around 14 minutes.</p><p>The second thing to notice is that we now have the execution time of each subtest. This information is crucial for
identifying slow tests and improving their performance.</p><p>The third thing to notice is that we now have information about parallelism. We can see how many tests are running
concurrently and how many tests are running in parallel. If we see a test with a low parallelism number, we know that
this test is a bottleneck and should parallelized.</p><p>The WARNING message indicates that the JSON output did not contain the start time of the test. This issue can happen if
the console output of the code under test does not include a new line and gets mixed with the output of Go&rsquo;s testing
package. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Time&#34;</span>: <span style=color:#e6db74>&#34;2024-08-26T19:23:17.8084601Z&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;output&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Package&#34;</span>: <span style=color:#e6db74>&#34;github.com/fleetdm/fleet/v4/cmd/fleetctl&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Test&#34;</span>: <span style=color:#e6db74>&#34;TestGenerateMDMApple/CSR_API_call_fails&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Output&#34;</span>: <span style=color:#e6db74>&#34;requesting APNs CSR: GET /api/latest/fleet/mdm/apple/request_csr received status 502 Bad Gateway: FleetDM CSR request failed: bad request=== RUN   TestGenerateMDMApple/successful_run\n&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=goteststats-on-github><a href=#goteststats-on-github class=header-anchor></a><code>goteststats</code> on GitHub</h2><p><a class=link href=https://github.com/getvictor/goteststats target=_blank rel=noopener>goteststats</a> is available on GitHub. You can use it to get detailed
performance data for your Go test suite.</p><h2 id=further-reading><a href=#further-reading class=header-anchor></a>Further reading</h2><ul><li>Recently, we wrote about <a class=link href=../optimizing-performance-of-go-app>optimizing the performance of Go applications</a>.</li><li>We also explored <a class=link href=../fuzz-testing-with-go>fuzz testing with Go</a>.</li><li>In addition, we showed <a class=link href=../exe-installer>how to create an EXE installer for a Go program</a>.</li><li>We also published an article on <a class=link href=../go-modules-and-packages>using Go modules and packages</a>.</li><li>And we wrote about <a class=link href=../track-engineering-metrics/>automatically tracking engineering metrics with Go</a>.</li></ul><h2 id=watch-how-to-measure-the-execution-time-of-go-tests-accurately><a href=#watch-how-to-measure-the-execution-time-of-go-tests-accurately class=header-anchor></a>Watch how to measure the execution time of Go tests accurately</h2><div class=video-wrapper><iframe loading=lazy src=https://www.youtube.com/embed/caTDvS5vCjA allowfullscreen title="YouTube Video"></iframe></div><p><em>Note:</em> If you want to comment on this article, please do so on the YouTube video.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/golang/>Golang</a>
<a href=/tags/unit-testing/>Unit Testing</a>
<a href=/tags/developer-experience/>Developer Experience</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/posts/fuzz-testing-with-go/><div class=article-image><img src=/posts/fuzz-testing-with-go/fuzz.703d0de0a5f916c5c4c5ce40d5b76eed_hu2511501376237727745.png width=250 height=150 loading=lazy alt="Featured image of post Fuzz testing in Go" data-hash="md5-cD0N4KX5FsXExc5A1bdu7Q=="></div><div class=article-details><h2 class=article-title>Fuzz testing in Go</h2></div></a></article><article class=has-image><a href=/posts/optimizing-performance-of-go-app/><div class=article-image><img src=/posts/optimizing-performance-of-go-app/race-cars-headline.183d0aca26b964d790229bf05059e03b_hu2443604692520476740.png width=250 height=150 loading=lazy alt="Featured image of post How to benchmark performance of Go serializers" data-hash="md5-GD0Kyia5ZNeQIpvwUFngOw=="></div><div class=article-details><h2 class=article-title>How to benchmark performance of Go serializers</h2></div></a></article><article class=has-image><a href=/posts/get-args-from-stdin/><div class=article-image><img src=/posts/get-args-from-stdin/stdin-headline.cf73246657a79bf645a99e743dca1f1f_hu12583255727335054652.png width=250 height=150 loading=lazy alt="Featured image of post Why you should use STDIN to read your program arguments" data-hash="md5-z3MkZlenm/ZFqZ50PcofHw=="></div><div class=article-details><h2 class=article-title>Why you should use STDIN to read your program arguments</h2></div></a></article><article class=has-image><a href=/posts/add-unit-tests-to-chrome-extension/><div class=article-image><img src=/posts/add-unit-tests-to-chrome-extension/chrome-jest-headline.8842ce8d87f35aae4aa45ba489709fe9_hu12457010979260978092.png width=250 height=150 loading=lazy alt="Featured image of post Add unit tests to Chrome extension (2024)" data-hash="md5-iELOjYfzWq5KpFukiXCf6Q=="></div><div class=article-details><h2 class=article-title>Add unit tests to Chrome extension (2024)</h2></div></a></article><article class=has-image><a href=/posts/mtls-go-client-windows-certificate-store/><div class=article-image><img src=/posts/mtls-go-client-windows-certificate-store/mtls-go-windows.0a8dfbc39a48ef72269453d3110b2806_hu14306420539221850309.png width=250 height=150 loading=lazy alt="Featured image of post Mutual TLS (mTLS) Go client using Windows certificate store" data-hash="md5-Co37w5pI73ImlFPTEQsoBg=="></div><div class=article-details><h2 class=article-title>Mutual TLS (mTLS) Go client using Windows certificate store</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2024 Victor on Software</section><section class=powerby></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>